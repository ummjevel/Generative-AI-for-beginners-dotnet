# æ¨™æº–çš„ãªç”ŸæˆAIã‚µãƒ³ãƒ—ãƒ«

å­¦ã‚“ã ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ã€ã“ã‚Œã‚‰ã®å®Ÿéš›çš„ã§ç¾å®Ÿä¸–ç•Œã®ã‚µãƒ³ãƒ—ãƒ«ã§ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

---

## é”æˆã§ãã‚‹ã“ã¨

- ç”Ÿæˆ AI ãŒæ—¢å­˜ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã©ã®ã‚ˆã†ã«çµ„ã¿è¾¼ã¾ã‚Œã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã€‚
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè¤‡é›‘ãªã‚·ãƒŠãƒªã‚ªã§ã©ã®ã‚ˆã†ã«æ©Ÿèƒ½ã™ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã€‚

## å«ã¾ã‚Œã‚‹ã‚µãƒ³ãƒ—ãƒ«
- [æ¨™æº–çš„ãªç”ŸæˆAIã‚µãƒ³ãƒ—ãƒ«](../../../04-PracticalSamples)
  - [é”æˆã§ãã‚‹ã“ã¨](../../../04-PracticalSamples)
  - [å«ã¾ã‚Œã‚‹ã‚µãƒ³ãƒ—ãƒ«](../../../04-PracticalSamples)
  - [eShopLite ãƒ‡ãƒ¢](../../../04-PracticalSamples)
    - [eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ - ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒª](../../../04-PracticalSamples)
    - [eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ - Azure AI Search](../../../04-PracticalSamples)
    - [eShopLite ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°](../../../04-PracticalSamples)
  - [ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ](../../../04-PracticalSamples)
  - [ã¾ã¨ã‚](../../../04-PracticalSamples)
    - [è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹](../../../04-PracticalSamples)
    - [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](../../../04-PracticalSamples)

[![å…¨ä½“è§£èª¬å‹•ç”»](https://img.youtube.com/vi/Ky4CACXJqR8/0.jpg)](https://youtu.be/Ky4CACXJqR8?feature=shared)

_â¬†ï¸ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹•ç”»ã‚’è¦‹ã‚‹â¬†ï¸_

## eShopLite ãƒ‡ãƒ¢

æœ€åˆã®ãƒ‡ãƒ¢ã¨ã—ã¦ã€**eShopLite** ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã¦ã„ãã¾ã™ã€‚**eShopLite** ã¯ã€ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ç”¨å“ã‚„ã‚­ãƒ£ãƒ³ãƒ—æ„›å¥½å®¶å‘ã‘ã®ã‚·ãƒ³ãƒ—ãƒ«ãªeã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€æ¤œç´¢æ©Ÿèƒ½ã®æœ€é©åŒ–ã€ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°åˆ†æãªã©ã€ç”ŸæˆAIã®æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¢ã§ã¯ã€[Azure OpenAI](https://azure.microsoft.com/products/ai-services/openai-service) ãŠã‚ˆã³ [Azure AI Foundry Models](https://ai.azure.com/) ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãŠã‘ã‚‹æ¨è«–ï¼ˆç”ŸæˆAIéƒ¨åˆ†ï¼‰ã‚’è¡Œã„ã¾ã™ã€‚

æœ€åˆã®ãƒ‡ãƒ¢ã§ã¯ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ ã‚«ãƒ¼ãƒãƒ«ã‚’ä½¿ç”¨ã—ã¦æ¤œç´¢æ©Ÿèƒ½ã‚’å¼·åŒ–ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã®æ–‡è„ˆã‚’ç†è§£ã—ã€æ­£ç¢ºãªçµæœã‚’æä¾›ã—ã¾ã™ã€‚

### eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢

[![eShop ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢è§£èª¬å‹•ç”»](https://img.youtube.com/vi/FlkruF6USro/0.jpg)](https://youtu.be/FlkruF6USro?feature=shared)

_â¬†ï¸ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹•ç”»ã‚’è¦‹ã‚‹â¬†ï¸_

eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã§ã¯ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ ã‚«ãƒ¼ãƒãƒ«ã‚’ä½¿ç”¨ã—ã¦eã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¤œç´¢æ©Ÿèƒ½ã‚’å¼·åŒ–ã—ã¾ã™ã€‚ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ ã‚«ãƒ¼ãƒãƒ«ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã®æ–‡è„ˆã‚’ç†è§£ã—ã€ã‚ˆã‚Šæ­£ç¢ºãªçµæœã‚’æä¾›ã§ãã‚‹å¼·åŠ›ãªæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½œæˆã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œæ–™ç†ã«ä½¿ãˆã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ã€ã¨æ¤œç´¢ã—ãŸå ´åˆã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã¯ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒƒãƒãƒ³ç”¨å“ã‚’æ¢ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç†è§£ã—ã€ã“ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã‚­ãƒ£ãƒ³ãƒ—ç”¨èª¿ç†å™¨å…·ã‚’è¿”ã—ã¾ã™ã€‚

> ğŸ§‘â€ğŸ’»**ã‚µãƒ³ãƒ—ãƒ«**: [eShopLite ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã‚µãƒ³ãƒ—ãƒ«](https://aka.ms/netaieshoplitesemanticsearch) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„

![eShopLite ã®æ¤œç´¢æ©Ÿèƒ½ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/search-eshoplite.066a1bd2d2be8ca0aedc75476dc0a167ffa9b9f7eb150bbddae26117aae55996.ja.png)

ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªå•†å“ã‚’ã‚ˆã‚Šç°¡å˜ã«è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ä½“é¨“ãŒå‘ä¸Šã—ã€å£²ä¸ŠãŒå¢—åŠ ã—ã¾ã™ã€‚ã“ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’æ ¼ç´ã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ«ã‚¹ãƒˆã‚¢ã€æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€è¨€èªãƒ¢ãƒ‡ãƒ«ãŒå¿…è¦ã§ã™ã€‚[.NET Aspire](https://learn.microsoft.com/dotnet/aspire/get-started/aspire-overview) ã®ãƒ„ãƒ¼ãƒ«ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã“ã‚Œã‚‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’èª¿æ•´ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

![.NET Aspire ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/aspire-dashboard.39a6c455137a44de910501fb6c0a2549a2124061f6f8c1a75d176959a16a0c75.ja.png)

.NET Aspire ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã¯ã€è£½å“ã€SQLã€ã‚¹ãƒˆã‚¢ã‚³ãƒ³ãƒ†ãƒŠãŒè¨€èªãƒ¢ãƒ‡ãƒ«ã¨ã©ã®ã‚ˆã†ã«ã‚„ã‚Šå–ã‚Šã™ã‚‹ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚Aspire ã‚¢ãƒ—ãƒªãƒ›ã‚¹ãƒˆã‚’è©³ã—ãè¦‹ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼š

```csharp
if (builder.ExecutionContext.IsPublishMode)
{
    // Add the Azure Application Insights for monitoring
    var appInsights = builder.AddAzureApplicationInsights("appInsights");
    // Add the Azure OpenAI for the chat and embeddings deployments, the embedding is used for the vector entities
    var chatDeploymentName = "gpt-4o-mini";
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var aoai = builder.AddAzureOpenAI("openai")
        .AddDeployment(new AzureOpenAIDeployment(chatDeploymentName,
        "gpt-4o-mini",
        "2024-07-18",
        "GlobalStandard",
        10))
        .AddDeployment(new AzureOpenAIDeployment(embeddingsDeploymentName,
        "text-embedding-ada-002",
        "2"));

    products.WithReference(appInsights)
        .WithReference(aoai)
        .WithEnvironment("AI_ChatDeploymentName", chatDeploymentName)
        .WithEnvironment("AI_embeddingsDeploymentName", embeddingsDeploymentName);

    store.WithReference(appInsights)
        .WithExternalHttpEndpoints();
}
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Azure Application Insights ã‚’ç›£è¦–ã®ãŸã‚ã«è¿½åŠ ã™ã‚‹æ–¹æ³•ã€Azure OpenAI ã‚’ãƒãƒ£ãƒƒãƒˆãŠã‚ˆã³åŸ‹ã‚è¾¼ã¿ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã«ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã€ãŠã‚ˆã³ãƒ™ã‚¯ãƒˆãƒ«ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ä½¿ç”¨ã™ã‚‹åŸ‹ã‚è¾¼ã¿ã®æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

åŸ‹ã‚è¾¼ã¿ãŠã‚ˆã³ AOAI ä½œæˆã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è£½å“ã‚³ãƒ³ãƒ†ãƒŠã§ç¢ºèªã§ãã¾ã™ï¼š

```csharp
var azureOpenAiClientName = "openai";
builder.AddAzureOpenAIClient(azureOpenAiClientName);

// get azure openai client and create Chat client from aspire hosting configuration
builder.Services.AddSingleton<ChatClient>(serviceProvider =>
{
    var chatDeploymentName = "gpt-4o-mini";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Chat client configuration, modelId: {chatDeploymentName}");
    ChatClient chatClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        chatClient = client.GetChatClient(chatDeploymentName);
    }...
}
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯ã€Azure OpenAI ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å–å¾—ã—ã€Aspire ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ§‹æˆã‹ã‚‰ãƒãƒ£ãƒƒãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚`chatDeploymentName` ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½¿ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã®åå‰ã§ã™ã€‚åŒã˜ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä½¿ç”¨ã—ã¦åŸ‹ã‚è¾¼ã¿ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ï¼š

```csharp
// get azure openai client and create embedding client from aspire hosting configuration
builder.Services.AddSingleton<EmbeddingClient>(serviceProvider =>
{
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Embeddings client configuration, modelId: {embeddingsDeploymentName}");
    EmbeddingClient embeddingsClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        embeddingsClient = client.GetEmbeddingClient(embeddingsDeploymentName);
    }...
});
```

ã“ã‚Œã«ã‚ˆã‚Šã€`MemoryContext` ã‚’ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã¨æ¯”è¼ƒã—ã¦æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„å•†å“ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ï¼š

```csharp
// Iterate over the products and add them to the memory
_logger.LogInformation("Adding product to memory: {Product}", product.Name);
var productInfo = $"[{product.Name}] is a product that costs [{product.Price}] and is described as [{product.Description}]";

// Create a new product vector
var productVector = new ProductVector
{
    Id = product.Id,
    Name = product.Name,
    Description = product.Description,
    Price = product.Price,
    ImageUrl = product.ImageUrl
};

// Generate the embedding for the product information
var result = await _embeddingClient.GenerateEmbeddingAsync(productInfo);

// Convert the embedding result to a float array and assign it to the product vector
productVector.Vector = result.Value.ToFloats();
var recordId = await _productsCollection.UpsertAsync(productVector);
_logger.LogInformation("Product added to memory: {Product} with recordId: {RecordId}", product.Name, recordId);
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã¯ã€è£½å“ã‚’åå¾©å‡¦ç†ã—ã€ãã‚Œã‚’ãƒ¡ãƒ¢ãƒªã«è¿½åŠ ã™ã‚‹æ–¹æ³•ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

æ–°ã—ã„è£½å“ãƒ™ã‚¯ãƒˆãƒ«ã‚’ä½œæˆã—ãŸå¾Œã€ãã‚Œã‚’ä½¿ç”¨ã—ã¦è£½å“æƒ…å ±ã®åŸ‹ã‚è¾¼ã¿ã‚’ç”Ÿæˆã—ã€åŸ‹ã‚è¾¼ã¿çµæœã‚’ãƒ•ãƒ­ãƒ¼ãƒˆé…åˆ—ã«å¤‰æ›ã—ã¦è£½å“ãƒ™ã‚¯ãƒˆãƒ«ã«å‰²ã‚Šå½“ã¦ã¾ã™ã€‚

`_productsCollection` ã¯ã€è£½å“ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¸ã®å‚ç…§ã§ã‚ã‚Šã€CosmosDB å‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ã—ã¦ recordId ã«å¿œã˜ãŸå¿œç­”ã‚’å–å¾—ã—ã¾ã™ï¼ˆã“ã®å ´åˆã¯ãƒ­ã‚°è¨˜éŒ²ç”¨ï¼‰ã€‚

ãã®å¾Œã€è£½å“ãŒãƒ¡ãƒ¢ãƒªã«è¿½åŠ ã•ã‚Œã€ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å†…ã®å„è£½å“ã«ã¤ã„ã¦ã“ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç¹°ã‚Šè¿”ã•ã‚Œã¾ã™ã€‚

ãã®å¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè£½å“ã‚’æ¤œç´¢ã™ã‚‹ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã¨è£½å“ãƒ™ã‚¯ãƒˆãƒ«ã‚’æ¯”è¼ƒã—ã€æœ€ã‚‚é–¢é€£æ€§ã®é«˜ã„è£½å“ã‚’è¿”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚

```csharp
try
{
    // Generate embedding for the search query
    var result = await _embeddingClient.GenerateEmbeddingAsync(search);
    var vectorSearchQuery = result.Value.ToFloats();

    var searchOptions = new VectorSearchOptions()
    {
        Top = 1, // Retrieve the top 1 result
        VectorPropertyName = "Vector"
    };

    // Search the vector database for the most similar product
    var searchResults = await _productsCollection.VectorizedSearchAsync(vectorSearchQuery, searchOptions);
    double searchScore = 0.0;
    await foreach (var searchItem in searchResults.Results)
    {
        if (searchItem.Score > 0.5)
        {
            // Product found, retrieve the product details
            firstProduct = new Product
            {
                Id = searchItem.Record.Id,
                Name = searchItem.Record.Name,
                Description = searchItem.Record.Description,
                Price = searchItem.Record.Price,
                ImageUrl = searchItem.Record.ImageUrl
            };

            searchScore = searchItem.Score.Value;
            responseText = $"The product [{firstProduct.Name}] fits with the search criteria [{search}][{searchItem.Score.Value.ToString("0.00")}]";
            _logger.LogInformation($"Search Response: {responseText}");
        }
    }

    // Generate a friendly response message using the found product information
    var prompt = @$"You are an intelligent assistant helping clients with their search about outdoor products. Generate a catchy and friendly message using the following information:
    - User Question: {search}
    - Found Product Name: {firstProduct.Name}
    - Found Product Description: {firstProduct.Description}
    - Found Product Price: {firstProduct.Price}
    Include the found product information in the response to the user question.";

    var messages = new List<ChatMessage>
    {
        new SystemChatMessage(_systemPrompt),
        new UserChatMessage(prompt)
    };

    _logger.LogInformation("{ChatHistory}", JsonConvert.SerializeObject(messages));

    var resultPrompt = await _chatClient.CompleteChatAsync(messages);
}
```

ä¸Šè¨˜ã®ã‚³ãƒ¼ãƒ‰ã«ã‚ˆã‚Šã€æ¤œç´¢ã‚¯ã‚¨ãƒªã®åŸ‹ã‚è¾¼ã¿ã‚’ç”Ÿæˆã—ã€ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã§æœ€ã‚‚é¡ä¼¼ã—ãŸè£½å“ã‚’æ¤œç´¢ã—ã€è¦‹ã¤ã‹ã£ãŸè£½å“æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ãªå•†å“ã‚’ã‚ˆã‚Šç°¡å˜ã«è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ä½“é¨“ãŒå‘ä¸Šã—ã€å£²ä¸ŠãŒå¢—åŠ ã—ã¾ã™ã€‚

ã•ã‚‰ã«ã€ç”ŸæˆAIãŒé€²åŒ–ã™ã‚‹ä¸­ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•ã‚’ç†è§£ã—æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã«ã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã¨ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãŒå¿…è¦ã§ã™ã€‚ã“ã“ã§ Azure Application Insights ã¨ .NET Aspire ãŒå½¹ç«‹ã¡ã¾ã™ã€‚

![.NET Aspire ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/aspire-tracing-eshoplite.d275de72c3984defef2af13544b8ea00735154556e8878bffe2bab90419edb82.ja.png)

.NET Aspire ã¯ã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã€AIãƒ¢ãƒ‡ãƒ«ã¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚„ã‚Šå–ã‚Šã‚’å«ã‚€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å‹•ä½œã‚’ç›£è¦–ãŠã‚ˆã³è¿½è·¡ã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’æä¾›ã—ã¾ã™ã€‚ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½ã¯ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚„ã‚¨ãƒ©ãƒ¼ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œã‚’ç‰¹å®šã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ€é©åŒ–ã—ã¦ã‚ˆã‚Šè‰¯ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã‚’æä¾›ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

![eShopLite ã® Azure Application Insights ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/app-insights-eshoplite.24b107e2a7be99ecf71f619147fcc08f0b7b038a144e72945eaa5443beb27a1c.ja.png)

ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•ã‚’ç†è§£ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ”¹å–„ã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã™ã€‚Azure Application Insights ã‚’å°å…¥ã—ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚„ã‚Šå–ã‚Šã‚’ç›£è¦–ã—ã¾ã™ã€‚

Application Insights ã¯åŒ…æ‹¬çš„ãªãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’æä¾›ã—ã€ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã©ã®ã‚ˆã†ã«ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã‚‹ã‹ã€ã‚¯ãƒ©ã‚¦ãƒ‰ã®åˆ©ç”¨çŠ¶æ³ã‚’æŠŠæ¡ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ç”»åƒã§ã¯ã€Application Insights ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®å‘¼ã³å‡ºã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã€å¿œç­”æ™‚é–“ãªã©ã€ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒç¢ºèªã§ãã¾ã™ã€‚

> ğŸ’¡ **ãƒ—ãƒ­ã®ãƒ’ãƒ³ãƒˆ**: eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã«ã¤ã„ã¦è©³ã—ãã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã‚’ã”è¦§ãã ã•ã„: https://aka.ms/netaieshoplitesemanticsearch

### eShopLite ã®ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ - Azure AI Search ã‚’ä½¿ç”¨

eShopLite ã®ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ¢ã§ã¯ã€**Azure AI Search** ã‚’ä½¿ç”¨ã—ã¦ eã‚³ãƒãƒ¼ã‚¹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æ¤œç´¢æ©Ÿèƒ½ã‚’å¼·åŒ–ã—ã¾ã™ã€‚Azure AI Search ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã®æ–‡è„ˆã‚’ç†è§£ã—ã€ã‚ˆã‚Šæ­£ç¢ºãªçµæœã‚’æä¾›ã™ã‚‹å¼·åŠ›ãªæ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½œæˆã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚

ã¾ãŸã€å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã‚’å‡¦ç†ã§ãã‚‹ã€ã‚ˆã‚Šã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã§ä¿¡é ¼æ€§ã®é«˜ã„æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚‚æä¾›ã—ã¾ã™ã€‚Azure AI Search ã«ã‚ˆã‚Šã€æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ°¸ç¶šåŒ–ã§ãã‚‹ãŸã‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå†èµ·å‹•ã—ã¦ã‚‚æƒ…å ±ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

- [eShopLite with Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### eShopLite ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°

[![eShop ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°è§£èª¬å‹•ç”»](https://img.youtube.com/vi/bx0hRNdr_bQ/0.jpg)](https://youtu.be/bx0hRNdr_bQ?feature=shared)

_â¬†ï¸ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹•ç”»ã‚’è¦‹ã‚‹â¬†ï¸_

eShopLite ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°ã§ã¯ã€GPT-4o ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ éŸ³å£°æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã€é¡§å®¢ã¨ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã®ä¼šè©±ã‚’åˆ†æã—ã€ã‚ˆã‚Šãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸé­…åŠ›çš„ãªä½“é¨“ã‚’æä¾›ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€é¡§å®¢ãŒè£½å“ã®æ¨å¥¨ã‚’æ±‚ã‚ãŸå ´åˆã€ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¯é¡§å®¢ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åˆ†æã—ã€ã‚ˆã‚Šæ­£ç¢ºã§é–¢é€£æ€§ã®é«˜ã„å¿œç­”ã‚’æä¾›ã—ã¾ã™ã€‚

> ğŸ§‘â€ğŸ’»**ã‚µãƒ³ãƒ—ãƒ«**: [eShopLite ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã‚µãƒ³ãƒ—ãƒ«](https://aka.ms/netaieshopliterealtimechat) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„

![eShopLite ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æã‚’ç¤ºã™ç”»åƒ](../../../04-PracticalSamples/images/realtime-analysis-eshoplite.gif)

ã“ã®æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ã«ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åˆ†æã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ãŸã‚ã®æ–°ã—ã„æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®å®Ÿè£…ã¯ `StoreRealtime\ConversationManager.cs` ã«ã‚ã‚Šã¾ã™ã€‚

```csharp
public async Task RunAsync(
    Stream audioInput, 
    Speaker audioOutput, 
    Func<string, Task> addMessageAsync, 
    Func<string, bool, Task> addChatMessageAsync, 
    CancellationToken cancellationToken)
{
    // Define the initial prompt for the assistant
    var prompt = $"""
        You are a useful assistant.
        Respond as succinctly as possible, in just a few words.
        Check the product database and external sources for information.
        The current date is {DateTime.Now.ToLongDateString()}
        """;
```

ã¾ãšã€ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã®åˆæœŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å®šç¾©ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã¨ã®ã‚„ã‚Šå–ã‚Šæ–¹æ³•ã‚’æŒ‡ç¤ºã—ã¾ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯æ˜ç¢ºã§ç°¡æ½”ã§ã‚ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã¯ã€AIãƒ¢ãƒ‡ãƒ«ã‹ã‚‰æ­£ç¢ºãªçµæœã‚’å¾—ã‚‹ãŸã‚ã«ä¸å¯æ¬ ã§ã™ã€‚

```csharp
// Notify the user that the connection is being established
await addMessageAsync("Connecting...");

// Send an initial greeting message
await addChatMessageAsync("Hello, how can I help?", false);

// Create AI functions for semantic search and product name search
var contosoSemanticSearchTool = AIFunctionFactory.Create(_contosoProductContext.SemanticSearchOutdoorProductsAsync);
var contosoSearchByProductNameTool = AIFunctionFactory.Create(_contosoProductContext.SearchOutdoorProductsByNameAsync);

// Add the AI functions to a list of tools
List<AIFunction> tools = new List<AIFunction> { contosoSemanticSearchTool, contosoSearchByProductNameTool };
```

æ¬¡ã«ã€ãƒãƒ£ãƒƒãƒˆã®æº–å‚™ãŒæ•´ã£ãŸã“ã¨ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã—ã€åˆæœŸã®æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¾ã™ã€‚ãã®å¾Œã€è£½å“æ¤œç´¢ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã€è£½å“åã«ã‚ˆã‚‹æ¤œç´¢ã®ãŸã‚ã®AIæ©Ÿèƒ½ãŒä½œæˆã•ã‚Œã€ãƒ„ãƒ¼ãƒ«ã®ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ã‚¨ãƒªã«é–¢é€£ã™ã‚‹æƒ…å ±ã‚’æä¾›ã§ãã¾ã™ã€‚

```csharp
// Configure the conversation session options
var sessionOptions = new ConversationSessionOptions()
{
    Instructions = prompt,
    Voice = ConversationVoice.Shimmer,
    InputTranscriptionOptions = new() { Model = "whisper-1" },
};

// Add each tool to the session options
foreach (var tool in tools)
{
    sessionOptions.Tools.Add(tool.ToConversationFunctionTool());
}

// Start the conversation session with the configured options
session = await client.StartConversationSessionAsync(cancellationToken);
await session.ConfigureSessionAsync(sessionOptions);

// Initialize a StringBuilder to store the output transcription
var outputTranscription = new StringBuilder();
```

ä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒæ§‹æˆã•ã‚Œã€æŒ‡ç¤ºã€éŸ³å£°ã€ãŠã‚ˆã³å…¥åŠ›ã®ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¾ã™ã€‚å…¥åŠ›ã®ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯ `Whisper-1` ãƒ¢ãƒ‡ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

å„ãƒ„ãƒ¼ãƒ«ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã•ã‚Œã€æ§‹æˆã•ã‚ŒãŸã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ä¼šè©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦å¤‰æ›´å¯èƒ½ã§ã™ã€‚

> ğŸ§‘â€ğŸ’»**ã‚µãƒ³ãƒ—ãƒ«**: [eShopLite ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ£ãƒƒãƒˆã‚µãƒ³ãƒ—ãƒ«](https://aka.ms/netaieshopliterealtimechat) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„

## ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ

[![ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè§£èª¬å‹•ç”»](https://img.youtube.com/vi/ZjZWilI_5z8/0.jpg)](https://youtu.be/ZjZWilI_5z8?feature=shared)

_â¬†ï¸ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å‹•ç”»ã‚’è¦‹ã‚‹â¬†ï¸_

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ç¾åœ¨ã®AIåˆ†é‡ã§é‡è¦ãªãƒˆãƒ”ãƒƒã‚¯ã§ã™ã€‚ãã®èƒ½åŠ›ã‚’ç¤ºã™ãŸã‚ã«ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã«åŸºã¥ã„ã¦å‰µé€ çš„ã§é­…åŠ›çš„ãªæ–‡ç« ã‚’ç”Ÿæˆã—ã€èª¿æŸ»ã•ã‚ŒãŸå…·ä½“çš„ã§é­…åŠ›çš„ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ›¸ãã®ã‚’åŠ©ã‘ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

> ğŸ§‘â€ğŸ’»**ã‚µãƒ³ãƒ—ãƒ«**: [ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](https://aka.ms/netaicreativewriter) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„

![ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç¤ºã™ç”»åƒ](../../../translated_images/creative-writer-agent.0a8b63b3dd31452661ae33425defdc472b4d941724d9172a28c5d79bdc5d2faf.ja.png)

ã“ã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€é«˜å“è³ªãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã«çµ„ã¿åˆã‚ã•ã‚ŒãŸ4ã¤ã®å°‚ç”¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¸­å¿ƒã«å±•é–‹ã•ã‚Œã¦ã„ã¾ã™ï¼š

- **Researcher**: Bing æ¤œç´¢ã‚’æ´»ç”¨ã—ã¦æ–‡è„ˆã€ãƒˆãƒ”ãƒƒã‚¯ã€ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã—ã€ãã‚Œã‚’ç°¡æ½”ã«è¦ç´„ã€‚
- **Marketing**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’è§£é‡ˆã—ã€é–¢é€£ã™ã‚‹è³ªå•ã‚’æ§‹ç¯‰ã—ã€æ­£ç¢ºãªçµæœã‚’å¾—ã‚‹ãŸã‚ã« Vector DB ã‚’æ´»ç”¨ã€‚
- **Writer**: Researcher ã¨ Marketing ã‹ã‚‰ã®çŸ¥è¦‹ã‚’çµ±åˆã—ã€è¨˜äº‹ã®ä¸€è²«æ€§ã‚ã‚‹åŸ·ç­†ã‚’ç”Ÿæˆã€‚
- **Editor**: ãƒ‰ãƒ©ãƒ•ãƒˆã‚’è©•ä¾¡ã—ã€ä¿®æ­£ã‚’ææ¡ˆã—ã€å…¬é–‹æº–å‚™ãŒæ•´ã£ã¦ã„ã‚‹ã‹ã‚’åˆ¤æ–­ã€‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€é–¢é€£ãƒ‡ãƒ¼ã‚¿ã€åŠ¹æœçš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’çµ±åˆã—ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ ã‚«ãƒ¼ãƒãƒ«ã€Microsoft AI Extensionã€ãŠã‚ˆã³ .NET Aspire ã«ã‚ˆã£ã¦ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¦ã„ã¾ã™ã€‚

![ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/creative-writer-agent-architecture.792ab7a807e66accb729c6a49d9393dd22f6060d83610cd1a187ab2b8a74efff.ja.png)

ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã©ã®ã‚ˆã†ã«ç›¸äº’ä½œç”¨ã™ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã€è‡ªåˆ†è‡ªèº«ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã™ã‚‹ãŸã‚ã®å‚è€ƒã«ãªã‚Šã¾ã™ã€‚ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®ç›¸äº’ä½œç”¨ã‚’ç†è§£ã—ã¦ãã ã•ã„ã€‚ã¾ãšã€Creative Writer ã¸ã® `ChatController.cs` å‘¼ã³å‡ºã—ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

```csharp
var userInput = request.Messages.Last();

// Deserialize the user input content into a CreateWriterRequest object
CreateWriterRequest createWriterRequest = _yamlDeserializer.Deserialize<CreateWriterRequest>(userInput.Content);

// Create a new session for the Creative Writer application
var session = await _creativeWriterApp.CreateSessionAsync(Response);

// Process the streaming request and write the response in real-time
await foreach (var delta in session.ProcessStreamingRequest(createWriterRequest))
{
    // Serialize the delta and write it to the response stream and flush
    await response.WriteAsync($"{JsonSerializer.Serialize(delta)}\r\n");
    await response.Body.FlushAsync();
}
```

`CreateWriterRequest` needs to have three properties: `Research`, `Products`, and `Writing`. After getting them setted by processing the request, it calls the `CreateSessionAsync` ãƒ¡ã‚½ãƒƒãƒ‰ã®å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

```csharp
internal async Task<CreativeWriterSession> CreateSessionAsync(HttpResponse response)
{
    // Add custom function invocation filters to handle response modifications
    defaultKernel.FunctionInvocationFilters.Add(new FunctionInvocationFilter(response));

    // Create a separate kernel for Bing search integration and intialize the Bing service, and create a plugin for Bing search
    Kernel bingKernel = defaultKernel.Clone();
    BingTextSearch textSearch = new(apiKey: configuration["BingAPIKey"]!);
    KernelPlugin searchPlugin = textSearch.CreateWithSearch("BingSearchPlugin");
    bingKernel.Plugins.Add(searchPlugin);

    // Clone the default kernel to set up the vector search capabilities, and create the vector search kernel
    Kernel vectorSearchKernel = defaultKernel.Clone();
    await ConfigureVectorSearchKernel(vectorSearchKernel);

    // Return a new session encapsulating all configured kernels for comprehensive AI functionalities
    return new CreativeWriterSession(defaultKernel, bingKernel, vectorSearchKernel);
}
```

æ¬¡ã«ã€`CreativeWriterSession` class for the `ProcessStreamingRequest` function, to understand how the components interact with each other, first look at the `Research` and `Marketing` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç¢ºèªã—ã¾ã™ï¼š

```csharp
// Initialize the Researcher Agent with a specific prompt template.
// This agent leverages the Bing Kernel for enhanced semantic search capabilities.
ChatCompletionAgent researcherAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/researcher.yaml"))
{
    Name = ResearcherName,
    Kernel = bingKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = bingKernel.LoggerFactory
};

// Initialize the Marketing Agent with its own prompt template.
// This agent utilizes the Vector Search Kernel to handle product-related queries efficiently.
ChatCompletionAgent marketingAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/marketing.yaml"))
{
    Name = MarketingName,
    Kernel = vectorSearchKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = vectorSearchKernel.LoggerFactory
};

// ...

// Invoke the Researcher Agent asynchronously with the provided research context.
await foreach (ChatMessageContent response in researcherAgent.InvokeAsync(
    new object[] { }, 
    new Dictionary<string, string> { { "research_context", createWriterRequest.Research } }))
{
    // Aggregate the research results for further processing or display.
    sbResearchResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(ResearcherName),
        Content = response.Content,
    });
}

// ...

// Invoke the Marketing Agent with the provided product context.
await foreach (ChatMessageContent response in marketingAgent.InvokeAsync(
    new object[] { },
    new Dictionary<string, string> { { "product_context", createWriterRequest.Products } }))
{
    // Consolidate the product-related results for use in marketing strategies or user feedback.
    sbProductResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(MarketingName),
        Content = response.Content,
    });
}
```

æœ€å¾Œã«ã€`Writer` and `Editor` ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’åˆæœŸåŒ–ãŠã‚ˆã³æ§‹æˆã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

```csharp
// Initialize the Writer Agent with its specific prompt configuration
ChatCompletionAgent writerAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/writer.yaml"))
{
    Name = WriterName, 
    Kernel = kernel, /
    Arguments = new Dictionary<string, string>(), 
    LoggerFactory = kernel.LoggerFactory 
};

// Initialize the Editor Agent with its specific prompt configuration
ChatCompletionAgent editorAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/editor.yaml"))
{
    Name = EditorName, 
    Kernel = kernel, 
    LoggerFactory = kernel.LoggerFactory
};

// Populate the Writer Agent with contextual data required for generating content, gathered from the User, Researcher and Marketing Agents
writerAgent.Arguments["research_context"] = createWriterRequest.Research;
writerAgent.Arguments["research_results"] = sbResearchResults.ToString();
writerAgent.Arguments["product_context"] = createWriterRequest.Products;
writerAgent.Arguments["product_results"] = sbProductResults.ToString();
writerAgent.Arguments["assignment"] = createWriterRequest.Writing;

// Configure the Agent Group Chat to manage interactions between Writer and Editor
AgentGroupChat chat = new(writerAgent, editorAgent)
{
    LoggerFactory = kernel.LoggerFactory,
    ExecutionSettings = new AgentGroupChatSettings
    {
        // Define the strategy for selecting which agent interacts next
        SelectionStrategy = new SequentialSelectionStrategy() 
        { 
            InitialAgent = writerAgent // Start the conversation with the Writer Agent
        },
        // Define the termination condition for the agent interactions, in this case, the Editor Agent will terminate the conversation
        TerminationStrategy = new NoFeedbackLeftTerminationStrategy()
    }
};
```

.NET Aspire ã§ã¯ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã©ã®ã‚ˆã†ã«ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªä½“é¨“ã‚’æä¾›ã—ã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚ãƒˆãƒ¬ãƒ¼ã‚¹æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ã‚„ã‚Šå–ã‚Šã‚’ç›£è¦–ã—ã€ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªãƒ¼æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œå‹•ã‚„AIãƒ¢ãƒ‡ãƒ«ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹æ´å¯Ÿã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
![.NET Aspire ã®ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°æ©Ÿèƒ½ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/aspire-tracing-creative-writer.fc87bb2777daf4e2efc54ea572c83ef7d09ce01cef4203d923e5591bde3b7fab.ja.png)

![.NET Aspire ã®ãƒ†ãƒ¬ãƒ¡ãƒˆãƒªæ©Ÿèƒ½ã‚’ç¤ºã™ç”»åƒ](../../../translated_images/aspire-telemetry-creative-writer.aba9fd2e674a3cb021e2ff7d592d849cd7ebe5988037154ecc84b1b969747b40.ja.png)

> ğŸ§‘â€ğŸ’»**ã‚µãƒ³ãƒ—ãƒ«**: [Creative Writing Agent ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰](https://aka.ms/netaicreativewriter)ã‚’ã”è¦§ãã ã•ã„ã€‚

## æ¦‚è¦

ã“ã‚Œã‚‰ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã§ ç”Ÿæˆ AI ã‚’æ´»ç”¨ã™ã‚‹æ–¹æ³•ã®ã»ã‚“ã®ä¸€ä¾‹ã«éãã¾ã›ã‚“ã€‚å¯èƒ½æ€§ã¯ç„¡é™å¤§ã§ã€æŠ€è¡“ã¯æ€¥é€Ÿã«é€²åŒ–ã—ã¦ã„ã¾ã™ã€‚ç”Ÿæˆ AI ã«ã¤ã„ã¦ã•ã‚‰ã«å­¦ã³ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ´»ç”¨ã™ã‚‹æ–¹æ³•ã‚’çŸ¥ã‚‹ãŸã‚ã«ã€ã„ãã¤ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’ã”è¦§ãã ã•ã„ã€‚

> ğŸ™‹ **ã‚µãƒãƒ¼ãƒˆãŒå¿…è¦ã§ã™ã‹ï¼Ÿ**: å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã§ Issue ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

### è¿½åŠ ãƒªã‚½ãƒ¼ã‚¹

- [eShopLite with DeepSeek](https://aka.ms/netaieshoplitedeepseekr1)
- [eShopLite with Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

è²¬ä»»ã‚ã‚‹ AI ã®å®Ÿè·µæ–¹æ³•ã‚’å­¦ã³ã€AI ãƒ¢ãƒ‡ãƒ«ãŒå€«ç†çš„ã§ã‚ã‚Šã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã“ã¨ã‚’ç¢ºä¿ã—ã¾ã—ã‚‡ã†ï¼

ğŸ‘‰ [è²¬ä»»ã‚ã‚‹ AI](../05-ResponsibleGenAI/readme.md)

**å…è²¬äº‹é …**:  
ã“ã®æ–‡æ›¸ã¯ã€æ©Ÿæ¢°ç¿»è¨³AIã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ç”¨ã—ã¦ç¿»è¨³ã•ã‚Œã¦ã„ã¾ã™ã€‚æ­£ç¢ºæ€§ã‚’è¿½æ±‚ã—ã¦ãŠã‚Šã¾ã™ãŒã€è‡ªå‹•ç¿»è¨³ã«ã¯èª¤ã‚Šã‚„ä¸æ­£ç¢ºã•ãŒå«ã¾ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚åŸæ–‡ï¼ˆå…ƒã®è¨€èªã®æ–‡æ›¸ï¼‰ãŒå…¬å¼ãªæƒ…å ±æºã¨ã—ã¦å„ªå…ˆã•ã‚Œã‚‹ã¹ãã§ã™ã€‚é‡è¦ãªæƒ…å ±ã«ã¤ã„ã¦ã¯ã€å°‚é–€ã®äººé–“ã«ã‚ˆã‚‹ç¿»è¨³ã‚’æ¨å¥¨ã—ã¾ã™ã€‚æœ¬ç¿»è¨³ã®ä½¿ç”¨ã«èµ·å› ã™ã‚‹èª¤è§£ã‚„èª¤ã£ãŸè§£é‡ˆã«ã¤ã„ã¦ã€å½“æ–¹ã¯ä¸€åˆ‡ã®è²¬ä»»ã‚’è² ã„ã¾ã›ã‚“ã€‚
