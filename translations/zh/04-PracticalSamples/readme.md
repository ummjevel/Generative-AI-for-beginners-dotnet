# è§„èŒƒç”Ÿæˆå¼ AI ç¤ºä¾‹

é€šè¿‡è¿™äº›å®é™…ä¸”è´´è¿‘ç°å®çš„ç¤ºä¾‹ï¼Œäº†è§£ä½ æ‰€å­¦çš„æ‰€æœ‰æ¦‚å¿µæ˜¯å¦‚ä½•åº”ç”¨çš„ã€‚

---

## ä½ å°†å®ç°çš„ç›®æ ‡

- äº†è§£ç”Ÿæˆå¼ AI å¦‚ä½•èå…¥ç°æœ‰åº”ç”¨ç¨‹åºã€‚
- ç†è§£ä»£ç†åœ¨å¤æ‚åœºæ™¯ä¸­çš„å·¥ä½œåŸç†ã€‚

## åŒ…å«çš„ç¤ºä¾‹
- [è§„èŒƒç”Ÿæˆå¼ AI ç¤ºä¾‹](../../../04-PracticalSamples)
  - [ä½ å°†å®ç°çš„ç›®æ ‡](../../../04-PracticalSamples)
  - [åŒ…å«çš„ç¤ºä¾‹](../../../04-PracticalSamples)
  - [eShopLite æ¼”ç¤º](../../../04-PracticalSamples)
    - [eShopLite çš„è¯­ä¹‰æœç´¢ - å†…å­˜å®ç°](../../../04-PracticalSamples)
    - [eShopLite çš„è¯­ä¹‰æœç´¢ - Azure AI Search å®ç°](../../../04-PracticalSamples)
    - [eShopLite çš„å®æ—¶éŸ³é¢‘](../../../04-PracticalSamples)
  - [åˆ›æ„å†™ä½œä»£ç†](../../../04-PracticalSamples)
  - [æ€»ç»“](../../../04-PracticalSamples)
    - [é™„åŠ èµ„æº](../../../04-PracticalSamples)
    - [ä¸‹ä¸€æ­¥](../../../04-PracticalSamples)

[![æ€»è§ˆè®²è§£è§†é¢‘](https://img.youtube.com/vi/Ky4CACXJqR8/0.jpg)](https://youtu.be/Ky4CACXJqR8?feature=shared)

_â¬†ï¸ç‚¹å‡»å›¾ç‰‡è§‚çœ‹è§†é¢‘â¬†ï¸_

## eShopLite æ¼”ç¤º

åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢ **eShopLite** é¡¹ç›®ã€‚**eShopLite** æ˜¯ä¸€ä¸ªé¢å‘æˆ·å¤–è£…å¤‡å’Œéœ²è¥çˆ±å¥½è€…çš„ç®€å•ç”µå•†åº”ç”¨ç¨‹åºï¼Œå¹¶é€šè¿‡ç”Ÿæˆå¼ AI åŠŸèƒ½è¿›è¡Œäº†å¢å¼ºï¼Œæ¯”å¦‚æœç´¢åŠŸèƒ½ä¼˜åŒ–ã€å®¢æˆ·æ”¯æŒå’Œå®æ—¶éŸ³é¢‘åˆ†æã€‚

è¿™äº›æ¼”ç¤ºä½¿ç”¨ [Azure OpenAI](https://azure.microsoft.com/products/ai-services/openai-service) å’Œ [Azure AI Foundry Models](https://ai.azure.com/) æ¥å®Œæˆæ¨ç†ä»»åŠ¡ï¼ˆå³åº”ç”¨ç¨‹åºä¸­çš„ç”Ÿæˆå¼ AI éƒ¨åˆ†ï¼‰ã€‚

åœ¨ç¬¬ä¸€ä¸ªæ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Semantic Kernel å¢å¼ºæœç´¢åŠŸèƒ½ï¼Œä½¿å…¶èƒ½å¤Ÿç†è§£ç”¨æˆ·æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡å¹¶æä¾›å‡†ç¡®çš„ç»“æœã€‚

### eShopLite çš„è¯­ä¹‰æœç´¢

[![eShop è¯­ä¹‰æœç´¢è®²è§£è§†é¢‘](https://img.youtube.com/vi/FlkruF6USro/0.jpg)](https://youtu.be/FlkruF6USro?feature=shared)

_â¬†ï¸ç‚¹å‡»å›¾ç‰‡è§‚çœ‹è§†é¢‘â¬†ï¸_

åœ¨ eShopLite çš„è¯­ä¹‰æœç´¢ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Semantic Kernel å¢å¼ºäº†ç”µå•†åº”ç”¨ç¨‹åºçš„æœç´¢åŠŸèƒ½ã€‚Semantic Kernel å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´å¼ºå¤§çš„æœç´¢å¼•æ“ï¼Œå®ƒèƒ½å¤Ÿç†è§£ç”¨æˆ·æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡å¹¶æä¾›æ›´å‡†ç¡®çš„ç»“æœã€‚

ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æœç´¢â€œä½ ä»¬æœ‰é€‚åˆåšé¥­çš„ä¸œè¥¿å—â€ï¼Œæœç´¢å¼•æ“å¯ä»¥ç†è§£ç”¨æˆ·å¯»æ‰¾çš„æ˜¯å¨æˆ¿ç”¨å…·ï¼Œå¹¶æ˜¾ç¤ºæœ€ç›¸å…³çš„äº§å“ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒä¼šè¿”å›éœ²è¥ç‚Šå…·ã€‚

> ğŸ§‘â€ğŸ’»**ç¤ºä¾‹**ï¼šæŸ¥çœ‹ [eShopLite è¯­ä¹‰æœç´¢ç¤ºä¾‹](https://aka.ms/netaieshoplitesemanticsearch)

![å±•ç¤º eShopLite æœç´¢åŠŸèƒ½çš„å›¾ç‰‡](../../../translated_images/search-eshoplite.066a1bd2d2be8ca0aedc75476dc0a167ffa9b9f7eb150bbddae26117aae55996.zh.png)

è¯­ä¹‰æœç´¢å¯ä»¥å¸®åŠ©ç”¨æˆ·æ›´è½»æ¾åœ°æ‰¾åˆ°æ‰€éœ€çš„äº§å“ï¼Œä»è€Œæ”¹å–„è´­ç‰©ä½“éªŒå¹¶å¢åŠ é”€å”®é¢ã€‚è¦å®ç°æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦æ‹¥æœ‰ä¸€ä¸ªåŒ…å«äº§å“çš„å‘é‡å­˜å‚¨ã€ä¸€ä¸ªæœç´¢ç´¢å¼•ä»¥åŠä¸€ä¸ªè¯­è¨€æ¨¡å‹ã€‚[.NET Aspire](https://learn.microsoft.com/dotnet/aspire/get-started/aspire-overview) å·¥å…·å¯å¸®åŠ©åè°ƒåå°çš„æ‰€æœ‰æµç¨‹ã€‚

![å±•ç¤º .NET Aspire ä»ªè¡¨æ¿çš„å›¾ç‰‡](../../../translated_images/aspire-dashboard.39a6c455137a44de910501fb6c0a2549a2124061f6f8c1a75d176959a16a0c75.zh.png)

åœ¨ .NET Aspire ä»ªè¡¨æ¿ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°äº§å“ã€SQL å’Œå­˜å‚¨å®¹å™¨ï¼Œå®ƒä»¬å¯ä»¥ä¸è¯­è¨€æ¨¡å‹äº¤äº’ã€‚æ·±å…¥æŸ¥çœ‹ Aspire åº”ç”¨ç¨‹åºä¸»æœºï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š

```csharp
if (builder.ExecutionContext.IsPublishMode)
{
    // Add the Azure Application Insights for monitoring
    var appInsights = builder.AddAzureApplicationInsights("appInsights");
    // Add the Azure OpenAI for the chat and embeddings deployments, the embedding is used for the vector entities
    var chatDeploymentName = "gpt-4o-mini";
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var aoai = builder.AddAzureOpenAI("openai")
        .AddDeployment(new AzureOpenAIDeployment(chatDeploymentName,
        "gpt-4o-mini",
        "2024-07-18",
        "GlobalStandard",
        10))
        .AddDeployment(new AzureOpenAIDeployment(embeddingsDeploymentName,
        "text-embedding-ada-002",
        "2"));

    products.WithReference(appInsights)
        .WithReference(aoai)
        .WithEnvironment("AI_ChatDeploymentName", chatDeploymentName)
        .WithEnvironment("AI_embeddingsDeploymentName", embeddingsDeploymentName);

    store.WithReference(appInsights)
        .WithExternalHttpEndpoints();
}
```

ä¸Šè¿°ä»£ç å±•ç¤ºäº†å¦‚ä½•æ·»åŠ  Azure åº”ç”¨ç¨‹åºæ´å¯Ÿä»¥è¿›è¡Œç›‘æ§ï¼Œæ·»åŠ  Azure OpenAI ç”¨äºèŠå¤©å’ŒåµŒå…¥éƒ¨ç½²ï¼Œä»¥åŠç”¨äºå‘é‡å®ä½“çš„åµŒå…¥ã€‚

åµŒå…¥å’Œ Azure OpenAI çš„åˆ›å»ºå¯ä»¥åœ¨äº§å“å®¹å™¨ä¸­æ‰¾åˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
var azureOpenAiClientName = "openai";
builder.AddAzureOpenAIClient(azureOpenAiClientName);

// get azure openai client and create Chat client from aspire hosting configuration
builder.Services.AddSingleton<ChatClient>(serviceProvider =>
{
    var chatDeploymentName = "gpt-4o-mini";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Chat client configuration, modelId: {chatDeploymentName}");
    ChatClient chatClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        chatClient = client.GetChatClient(chatDeploymentName);
    }...
}
```

ä¸Šè¿°ä»£ç å±•ç¤ºäº†å¦‚ä½•ä» Aspire æ‰˜ç®¡é…ç½®ä¸­è·å– Azure OpenAI å®¢æˆ·ç«¯å¹¶åˆ›å»ºèŠå¤©å®¢æˆ·ç«¯ã€‚`chatDeploymentName` æ˜¯åº”ç”¨ç¨‹åºä¸­éƒ¨ç½²çš„åç§°ã€‚åŒæ ·çš„è¿‡ç¨‹ä¹Ÿç”¨äºåˆ›å»ºåµŒå…¥å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
// get azure openai client and create embedding client from aspire hosting configuration
builder.Services.AddSingleton<EmbeddingClient>(serviceProvider =>
{
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Embeddings client configuration, modelId: {embeddingsDeploymentName}");
    EmbeddingClient embeddingsClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        embeddingsClient = client.GetEmbeddingClient(embeddingsDeploymentName);
    }...
});
```

é€šè¿‡è¿™äº›ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»º `MemoryContext`ï¼Œä½œä¸ºæˆ‘ä»¬çš„å‘é‡å­˜å‚¨ï¼Œç”¨äºä¸ç”¨æˆ·æŸ¥è¯¢è¿›è¡Œæ¯”è¾ƒå¹¶è¿”å›æœ€ç›¸å…³çš„äº§å“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
// Iterate over the products and add them to the memory
_logger.LogInformation("Adding product to memory: {Product}", product.Name);
var productInfo = $"[{product.Name}] is a product that costs [{product.Price}] and is described as [{product.Description}]";

// Create a new product vector
var productVector = new ProductVector
{
    Id = product.Id,
    Name = product.Name,
    Description = product.Description,
    Price = product.Price,
    ImageUrl = product.ImageUrl
};

// Generate the embedding for the product information
var result = await _embeddingClient.GenerateEmbeddingAsync(productInfo);

// Convert the embedding result to a float array and assign it to the product vector
productVector.Vector = result.Value.ToFloats();
var recordId = await _productsCollection.UpsertAsync(productVector);
_logger.LogInformation("Product added to memory: {Product} with recordId: {RecordId}", product.Name, recordId);
```

ä¸Šè¿°ä»£ç å±•ç¤ºäº†å¦‚ä½•éå†äº§å“å¹¶å°†å…¶æ·»åŠ åˆ°å†…å­˜ä¸­ã€‚

åœ¨åˆ›å»ºæ–°çš„äº§å“å‘é‡åï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒä¸ºäº§å“ä¿¡æ¯ç”ŸæˆåµŒå…¥ï¼Œå°†åµŒå…¥ç»“æœè½¬æ¢ä¸ºæµ®ç‚¹æ•°ç»„ï¼Œå¹¶å°†å…¶åˆ†é…ç»™äº§å“å‘é‡ã€‚

æŸ¥çœ‹ `_productsCollection`ï¼Œå®ƒæ˜¯å­˜å‚¨äº§å“çš„å®¹å™¨çš„å¼•ç”¨ï¼Œé€šè¿‡ CosmosDB è°ƒç”¨è·å–è®°å½• ID çš„å“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨äºæ—¥å¿—è®°å½•ã€‚

ç„¶åå°†äº§å“æ·»åŠ åˆ°å†…å­˜ä¸­ï¼Œå¯¹é›†åˆä¸­çš„æ¯ä¸ªäº§å“é‡å¤æ­¤è¿‡ç¨‹ã€‚

ä¹‹åï¼Œå½“ç”¨æˆ·æœç´¢äº§å“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·çš„æŸ¥è¯¢ä¸äº§å“å‘é‡è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›æœ€ç›¸å…³çš„äº§å“ã€‚

```csharp
try
{
    // Generate embedding for the search query
    var result = await _embeddingClient.GenerateEmbeddingAsync(search);
    var vectorSearchQuery = result.Value.ToFloats();

    var searchOptions = new VectorSearchOptions()
    {
        Top = 1, // Retrieve the top 1 result
        VectorPropertyName = "Vector"
    };

    // Search the vector database for the most similar product
    var searchResults = await _productsCollection.VectorizedSearchAsync(vectorSearchQuery, searchOptions);
    double searchScore = 0.0;
    await foreach (var searchItem in searchResults.Results)
    {
        if (searchItem.Score > 0.5)
        {
            // Product found, retrieve the product details
            firstProduct = new Product
            {
                Id = searchItem.Record.Id,
                Name = searchItem.Record.Name,
                Description = searchItem.Record.Description,
                Price = searchItem.Record.Price,
                ImageUrl = searchItem.Record.ImageUrl
            };

            searchScore = searchItem.Score.Value;
            responseText = $"The product [{firstProduct.Name}] fits with the search criteria [{search}][{searchItem.Score.Value.ToString("0.00")}]";
            _logger.LogInformation($"Search Response: {responseText}");
        }
    }

    // Generate a friendly response message using the found product information
    var prompt = @$"You are an intelligent assistant helping clients with their search about outdoor products. Generate a catchy and friendly message using the following information:
    - User Question: {search}
    - Found Product Name: {firstProduct.Name}
    - Found Product Description: {firstProduct.Description}
    - Found Product Price: {firstProduct.Price}
    Include the found product information in the response to the user question.";

    var messages = new List<ChatMessage>
    {
        new SystemChatMessage(_systemPrompt),
        new UserChatMessage(prompt)
    };

    _logger.LogInformation("{ChatHistory}", JsonConvert.SerializeObject(messages));

    var resultPrompt = await _chatClient.CompleteChatAsync(messages);
}
```

é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬ä¸ºæœç´¢æŸ¥è¯¢ç”ŸæˆåµŒå…¥ï¼Œåœ¨å‘é‡æ•°æ®åº“ä¸­æœç´¢æœ€ç›¸ä¼¼çš„äº§å“ï¼Œå¹¶ä½¿ç”¨æ‰¾åˆ°çš„äº§å“ä¿¡æ¯ç”Ÿæˆå“åº”æ¶ˆæ¯ã€‚

è¿™æœ‰åŠ©äºç”¨æˆ·æ›´è½»æ¾åœ°æ‰¾åˆ°æ‰€éœ€çš„äº§å“ï¼Œä»è€Œæ”¹å–„è´­ç‰©ä½“éªŒå¹¶å¢åŠ é”€å”®é¢ã€‚

æ­¤å¤–ï¼Œéšç€ç”Ÿæˆå¼ AI çš„å‘å±•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é¥æµ‹å’Œç›‘æ§æ¥äº†è§£ç”¨æˆ·è¡Œä¸ºå¹¶æ”¹è¿›æœç´¢å¼•æ“ï¼Œè¿™å°±æ˜¯ Azure åº”ç”¨ç¨‹åºæ´å¯Ÿå’Œ .NET Aspire çš„ä½œç”¨ã€‚

![å±•ç¤º .NET Aspire è·Ÿè¸ªåŠŸèƒ½çš„å›¾ç‰‡](../../../translated_images/aspire-tracing-eshoplite.d275de72c3984defef2af13544b8ea00735154556e8878bffe2bab90419edb82.zh.png)

.NET Aspire æä¾›äº†ä¸€å¥—å¼ºå¤§çš„å·¥å…·æ¥ç›‘æ§å’Œè·Ÿè¸ªåº”ç”¨ç¨‹åºçš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¸æœç´¢å¼•æ“ã€åå°æœåŠ¡å’Œ AI æ¨¡å‹çš„äº¤äº’ã€‚è·Ÿè¸ªåŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£å¯èƒ½çš„ç“¶é¢ˆã€é”™è¯¯å’Œæ€§èƒ½é—®é¢˜ï¼Œä»è€Œä¼˜åŒ–åº”ç”¨ç¨‹åºå¹¶æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

![å±•ç¤º eShopLite ä¸­çš„ Azure åº”ç”¨ç¨‹åºæ´å¯Ÿçš„å›¾ç‰‡](../../../translated_images/app-insights-eshoplite.24b107e2a7be99ecf71f619147fcc08f0b7b038a144e72945eaa5443beb27a1c.zh.png)

ç”±äºé¥æµ‹å¯¹äºäº†è§£ç”¨æˆ·è¡Œä¸ºå’Œæ”¹è¿›æœåŠ¡è‡³å…³é‡è¦ï¼Œæˆ‘ä»¬å¼•å…¥äº† Azure åº”ç”¨ç¨‹åºæ´å¯Ÿæ¥ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œç”¨æˆ·äº¤äº’ã€‚

åº”ç”¨ç¨‹åºæ´å¯Ÿæä¾›äº†ä¸€æ•´å¥—å…¨é¢çš„é¥æµ‹æ•°æ®ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£æœåŠ¡çš„è¿è¡Œæƒ…å†µã€ç”¨æˆ·å¦‚ä½•ä¸åº”ç”¨ç¨‹åºäº¤äº’ä»¥åŠäº‘ç«¯èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚

åœ¨å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºæ´å¯Ÿä»ªè¡¨æ¿ï¼Œæ˜¾ç¤ºæœåŠ¡çš„è¿è¡Œæƒ…å†µï¼Œä¾‹å¦‚å¯¹æ•°æ®åº“çš„è°ƒç”¨æ¬¡æ•°ã€è¯·æ±‚æ•°é‡ä»¥åŠå“åº”æ—¶é—´ã€‚

> ğŸ’¡ **æç¤º**ï¼šæœ‰å…³ eShopLite è¯­ä¹‰æœç´¢çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤å­˜å‚¨åº“ä»¥äº†è§£æ›´å¤šå†…å®¹ï¼šhttps://aka.ms/netaieshoplitesemanticsearch

### eShopLite çš„è¯­ä¹‰æœç´¢ä½¿ç”¨ Azure AI Search

åœ¨ eShopLite çš„ç«¯åˆ°ç«¯æ¼”ç¤ºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ **Azure AI Search** å¢å¼ºäº†ç”µå•†åº”ç”¨ç¨‹åºçš„æœç´¢åŠŸèƒ½ã€‚Azure AI Search å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ›´å¼ºå¤§çš„æœç´¢å¼•æ“ï¼Œå®ƒèƒ½å¤Ÿç†è§£ç”¨æˆ·æŸ¥è¯¢çš„ä¸Šä¸‹æ–‡å¹¶æä¾›æ›´å‡†ç¡®çš„ç»“æœã€‚

å®ƒè¿˜æä¾›äº†ä¸€ä¸ªæ›´å…·å¯æ‰©å±•æ€§å’Œå¯é æ€§çš„æœç´¢å¼•æ“ï¼Œå¯ä»¥å¤„ç†å¤§é‡æ•°æ®å’Œç”¨æˆ·æŸ¥è¯¢ã€‚Azure AI Search å…è®¸è§£å†³æ–¹æ¡ˆæŒä¹…åŒ–æœç´¢ç´¢å¼•ï¼Œå› æ­¤å³ä½¿åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨ï¼Œä¿¡æ¯ä¹Ÿä¼šä¿æŒå¯ç”¨ã€‚

- [eShopLite ä½¿ç”¨ Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### eShopLite çš„å®æ—¶éŸ³é¢‘

[![eShop å®æ—¶éŸ³é¢‘è®²è§£è§†é¢‘](https://img.youtube.com/vi/bx0hRNdr_bQ/0.jpg)](https://youtu.be/bx0hRNdr_bQ?feature=shared)

_â¬†ï¸ç‚¹å‡»å›¾ç‰‡è§‚çœ‹è§†é¢‘â¬†ï¸_

åœ¨ eShopLite çš„å®æ—¶éŸ³é¢‘ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ GPT-4o çš„å®æ—¶éŸ³é¢‘åŠŸèƒ½åˆ†æå®¢æˆ·ä¸èŠå¤©æœºå™¨äººçš„å¯¹è¯ï¼Œæä¾›æ›´ä¸ªæ€§åŒ–å’Œäº’åŠ¨çš„ä½“éªŒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·è¯·æ±‚äº§å“æ¨èï¼ŒèŠå¤©æœºå™¨äººå¯ä»¥å®æ—¶åˆ†æå®¢æˆ·çš„è¯·æ±‚å¹¶æä¾›æ›´å‡†ç¡®å’Œç›¸å…³çš„å“åº”ã€‚

> ğŸ§‘â€ğŸ’»**ç¤ºä¾‹**ï¼šæŸ¥çœ‹ [eShopLite å®æ—¶èŠå¤©ç¤ºä¾‹](https://aka.ms/netaieshopliterealtimechat)

![å±•ç¤º eShopLite ä¸­å®æ—¶åˆ†æåŠŸèƒ½çš„å›¾ç‰‡](../../../04-PracticalSamples/images/realtime-analysis-eshoplite.gif)

è¦å®ç°æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å®ç°æ–°åŠŸèƒ½æ¥åˆ›å»ºå®æ—¶åˆ†æçš„ç«¯ç‚¹ï¼Œå¯ä»¥åœ¨ `StoreRealtime\ConversationManager.cs` ä¸­æ‰¾åˆ°å®æ—¶åˆ†æçš„å®ç°ã€‚

```csharp
public async Task RunAsync(
    Stream audioInput, 
    Speaker audioOutput, 
    Func<string, Task> addMessageAsync, 
    Func<string, bool, Task> addChatMessageAsync, 
    CancellationToken cancellationToken)
{
    // Define the initial prompt for the assistant
    var prompt = $"""
        You are a useful assistant.
        Respond as succinctly as possible, in just a few words.
        Check the product database and external sources for information.
        The current date is {DateTime.Now.ToLongDateString()}
        """;
```

é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºåŠ©æ‰‹å®šä¹‰åˆå§‹æç¤ºï¼Œä¸ºç”¨æˆ·æä¾›ä¸èŠå¤©æœºå™¨äººäº¤äº’çš„æŒ‡å¯¼ã€‚è®°ä½ä½¿ç”¨æ¸…æ™°ç®€æ´çš„æç¤ºï¼Œæç¤ºå·¥ç¨‹å¯¹äºä» AI æ¨¡å‹ä¸­è·å¾—å‡†ç¡®ç»“æœè‡³å…³é‡è¦ã€‚

```csharp
// Notify the user that the connection is being established
await addMessageAsync("Connecting...");

// Send an initial greeting message
await addChatMessageAsync("Hello, how can I help?", false);

// Create AI functions for semantic search and product name search
var contosoSemanticSearchTool = AIFunctionFactory.Create(_contosoProductContext.SemanticSearchOutdoorProductsAsync);
var contosoSearchByProductNameTool = AIFunctionFactory.Create(_contosoProductContext.SearchOutdoorProductsByNameAsync);

// Add the AI functions to a list of tools
List<AIFunction> tools = new List<AIFunction> { contosoSemanticSearchTool, contosoSearchByProductNameTool };
```

æ¥ç€ï¼Œæˆ‘ä»¬é€šçŸ¥ç”¨æˆ·èŠå¤©å·²å‡†å¤‡å¥½å¼€å§‹ï¼Œå¹¶å‘é€åˆå§‹é—®å€™æ¶ˆæ¯ã€‚ç„¶åï¼Œåˆ›å»ºç”¨äºæœç´¢äº§å“ã€è¯­ä¹‰æœç´¢å’ŒæŒ‰äº§å“åç§°æœç´¢çš„ AI åŠŸèƒ½ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°å·¥å…·åˆ—è¡¨ä¸­ã€‚è¿™äº›å·¥å…·å¯ç”¨äºä¸ºç”¨æˆ·çš„æŸ¥è¯¢æä¾›ç›¸å…³ä¿¡æ¯ã€‚

```csharp
// Configure the conversation session options
var sessionOptions = new ConversationSessionOptions()
{
    Instructions = prompt,
    Voice = ConversationVoice.Shimmer,
    InputTranscriptionOptions = new() { Model = "whisper-1" },
};

// Add each tool to the session options
foreach (var tool in tools)
{
    sessionOptions.Tools.Add(tool.ToConversationFunctionTool());
}

// Start the conversation session with the configured options
session = await client.StartConversationSessionAsync(cancellationToken);
await session.ConfigureSessionAsync(sessionOptions);

// Initialize a StringBuilder to store the output transcription
var outputTranscription = new StringBuilder();
```

é…ç½®å¯¹è¯ä¼šè¯é€‰é¡¹ï¼ŒåŒ…æ‹¬æŒ‡ä»¤ã€è¯­éŸ³å’Œè¾“å…¥è½¬å½•é€‰é¡¹ã€‚ä½¿ç”¨ `Whisper-1` æ¨¡å‹è¿›è¡Œè¾“å…¥è½¬å½•ã€‚

å°†æ¯ä¸ªå·¥å…·æ·»åŠ åˆ°ä¼šè¯é€‰é¡¹ä¸­ï¼Œå¹¶ä½¿ç”¨é…ç½®çš„é€‰é¡¹å¯åŠ¨å¯¹è¯ä¼šè¯ã€‚è¿™äº›é€‰é¡¹å¯ä»¥æ ¹æ®ç”¨æˆ·éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚

> ğŸ§‘â€ğŸ’»**ç¤ºä¾‹**ï¼šæŸ¥çœ‹ [eShopLite å®æ—¶èŠå¤©ç¤ºä¾‹](https://aka.ms/netaieshopliterealtimechat)

## åˆ›æ„å†™ä½œä»£ç†

[![åˆ›æ„å†™ä½œä»£ç†è®²è§£è§†é¢‘](https://img.youtube.com/vi/ZjZWilI_5z8/0.jpg)](https://youtu.be/ZjZWilI_5z8?feature=shared)

_â¬†ï¸ç‚¹å‡»å›¾ç‰‡è§‚çœ‹è§†é¢‘â¬†ï¸_

ä»£ç†æ˜¯å½“å‰ AI é¢†åŸŸä¸­çš„ä¸€ä¸ªé‡è¦è¯é¢˜ï¼Œä¸ºäº†å±•ç¤ºå…¶èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åˆ›æ„å†™ä½œä»£ç†ã€‚è¿™æ˜¯ä¸€ç§å·¥å…·ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„è¾“å…¥ç”Ÿæˆåˆ›æ„ä¸”å¸å¼•äººçš„æ–‡æœ¬ï¼Œå¸®åŠ©æ’°å†™ç»è¿‡ç ”ç©¶ã€å…·ä½“ä¸”å¼•äººå…¥èƒœçš„å†…å®¹ã€‚

> ğŸ§‘â€ğŸ’»**ç¤ºä¾‹**ï¼šæŸ¥çœ‹ [åˆ›æ„å†™ä½œä»£ç†ç¤ºä¾‹ä»£ç ](https://aka.ms/netaicreativewriter)

![å±•ç¤ºåˆ›æ„å†™ä½œä»£ç†çš„å›¾ç‰‡](../../../translated_images/creative-writer-agent.0a8b63b3dd31452661ae33425defdc472b4d941724d9172a28c5d79bdc5d2faf.zh.png)

è¯¥è§£å†³æ–¹æ¡ˆå›´ç»•å››ä¸ªä¸“ç”¨æ¨¡å—å±•å¼€ï¼Œè¿™äº›æ¨¡å—ç»“åˆèµ·æ¥ç”Ÿæˆé«˜è´¨é‡å†…å®¹ï¼š

- **ç ”ç©¶å‘˜**ï¼šåˆ©ç”¨ Bing æœç´¢æ”¶é›†ä¸Šä¸‹æ–‡ã€ä¸»é¢˜å’Œæ•°æ®ï¼Œå¹¶ç®€è¦æ€»ç»“ã€‚
- **å¸‚åœºè¥é”€**ï¼šè§£é‡Šç”¨æˆ·æ„å›¾ï¼Œæ„å»ºç›¸å…³é—®é¢˜ï¼Œå¹¶æŸ¥è¯¢å‘é‡æ•°æ®åº“ä»¥è·å–ç²¾ç¡®ç»“æœã€‚
- **ä½œè€…**ï¼šç»¼åˆç ”ç©¶å‘˜å’Œå¸‚åœºè¥é”€çš„å‘ç°ï¼Œæ’°å†™è¿è´¯çš„æ–‡ç« ã€‚
- **ç¼–è¾‘**ï¼šè¯„ä¼°è‰ç¨¿ï¼Œæä¾›ä¿®æ”¹å»ºè®®ï¼Œå¹¶å†³å®šæ˜¯å¦å¯ä»¥å‘å¸ƒã€‚

æ•´ä¸ªå·¥ä½œæµæ•´åˆäº†ç›¸å…³æ•°æ®ã€æœ‰æ•ˆçš„æ¶ˆæ¯ä¼ é€’å’Œå®¡æ ¸åŠŸèƒ½ï¼Œç”± Semantic Kernelã€Microsoft AI Extension å’Œ .NET Aspire å…±åŒç¼–æ’ã€‚

![å±•ç¤ºåˆ›æ„å†™ä½œä»£ç†æ¶æ„çš„å›¾ç‰‡](../../../translated_images/creative-writer-agent-architecture.792ab7a807e66accb729c6a49d9393dd22f6060d83610cd1a187ab2b8a74efff.zh.png)

ç†è§£è¿™äº›ç»„ä»¶ä¹‹é—´çš„äº¤äº’æ–¹å¼å¯ä»¥ä¸ºåˆ›å»ºä½ è‡ªå·±çš„ä»£ç†åº”ç”¨ç¨‹åºæä¾›å‚è€ƒã€‚æŸ¥çœ‹ä»¥ä¸‹ä»£ç ä»¥äº†è§£ç»„ä»¶å¦‚ä½•ç›¸äº’äº¤äº’ï¼Œé¦–å…ˆæŸ¥çœ‹ `ChatController.cs` ä¸­å¯¹åˆ›æ„å†™ä½œä»£ç†çš„è°ƒç”¨ï¼š

```csharp
var userInput = request.Messages.Last();

// Deserialize the user input content into a CreateWriterRequest object
CreateWriterRequest createWriterRequest = _yamlDeserializer.Deserialize<CreateWriterRequest>(userInput.Content);

// Create a new session for the Creative Writer application
var session = await _creativeWriterApp.CreateSessionAsync(Response);

// Process the streaming request and write the response in real-time
await foreach (var delta in session.ProcessStreamingRequest(createWriterRequest))
{
    // Serialize the delta and write it to the response stream and flush
    await response.WriteAsync($"{JsonSerializer.Serialize(delta)}\r\n");
    await response.Body.FlushAsync();
}
```

ç±»å‹ `CreateWriterRequest` needs to have three properties: `Research`, `Products`, and `Writing`. After getting them setted by processing the request, it calls the `CreateSessionAsync` æ–¹æ³•ï¼Œçœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
internal async Task<CreativeWriterSession> CreateSessionAsync(HttpResponse response)
{
    // Add custom function invocation filters to handle response modifications
    defaultKernel.FunctionInvocationFilters.Add(new FunctionInvocationFilter(response));

    // Create a separate kernel for Bing search integration and intialize the Bing service, and create a plugin for Bing search
    Kernel bingKernel = defaultKernel.Clone();
    BingTextSearch textSearch = new(apiKey: configuration["BingAPIKey"]!);
    KernelPlugin searchPlugin = textSearch.CreateWithSearch("BingSearchPlugin");
    bingKernel.Plugins.Add(searchPlugin);

    // Clone the default kernel to set up the vector search capabilities, and create the vector search kernel
    Kernel vectorSearchKernel = defaultKernel.Clone();
    await ConfigureVectorSearchKernel(vectorSearchKernel);

    // Return a new session encapsulating all configured kernels for comprehensive AI functionalities
    return new CreativeWriterSession(defaultKernel, bingKernel, vectorSearchKernel);
}
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° `CreativeWriterSession` class for the `ProcessStreamingRequest` function, to understand how the components interact with each other, first look at the `Research` and `Marketing` ç»„ä»¶ï¼š

```csharp
// Initialize the Researcher Agent with a specific prompt template.
// This agent leverages the Bing Kernel for enhanced semantic search capabilities.
ChatCompletionAgent researcherAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/researcher.yaml"))
{
    Name = ResearcherName,
    Kernel = bingKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = bingKernel.LoggerFactory
};

// Initialize the Marketing Agent with its own prompt template.
// This agent utilizes the Vector Search Kernel to handle product-related queries efficiently.
ChatCompletionAgent marketingAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/marketing.yaml"))
{
    Name = MarketingName,
    Kernel = vectorSearchKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = vectorSearchKernel.LoggerFactory
};

// ...

// Invoke the Researcher Agent asynchronously with the provided research context.
await foreach (ChatMessageContent response in researcherAgent.InvokeAsync(
    new object[] { }, 
    new Dictionary<string, string> { { "research_context", createWriterRequest.Research } }))
{
    // Aggregate the research results for further processing or display.
    sbResearchResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(ResearcherName),
        Content = response.Content,
    });
}

// ...

// Invoke the Marketing Agent with the provided product context.
await foreach (ChatMessageContent response in marketingAgent.InvokeAsync(
    new object[] { },
    new Dictionary<string, string> { { "product_context", createWriterRequest.Products } }))
{
    // Consolidate the product-related results for use in marketing strategies or user feedback.
    sbProductResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(MarketingName),
        Content = response.Content,
    });
}
```

ç°åœ¨ï¼Œæˆ‘ä»¬åˆå§‹åŒ–å¹¶é…ç½® `Writer` and `Editor` ä»£ç†ã€‚æŸ¥çœ‹ä»¥ä¸‹ä»£ç ï¼š

```csharp
// Initialize the Writer Agent with its specific prompt configuration
ChatCompletionAgent writerAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/writer.yaml"))
{
    Name = WriterName, 
    Kernel = kernel, /
    Arguments = new Dictionary<string, string>(), 
    LoggerFactory = kernel.LoggerFactory 
};

// Initialize the Editor Agent with its specific prompt configuration
ChatCompletionAgent editorAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/editor.yaml"))
{
    Name = EditorName, 
    Kernel = kernel, 
    LoggerFactory = kernel.LoggerFactory
};

// Populate the Writer Agent with contextual data required for generating content, gathered from the User, Researcher and Marketing Agents
writerAgent.Arguments["research_context"] = createWriterRequest.Research;
writerAgent.Arguments["research_results"] = sbResearchResults.ToString();
writerAgent.Arguments["product_context"] = createWriterRequest.Products;
writerAgent.Arguments["product_results"] = sbProductResults.ToString();
writerAgent.Arguments["assignment"] = createWriterRequest.Writing;

// Configure the Agent Group Chat to manage interactions between Writer and Editor
AgentGroupChat chat = new(writerAgent, editorAgent)
{
    LoggerFactory = kernel.LoggerFactory,
    ExecutionSettings = new AgentGroupChatSettings
    {
        // Define the strategy for selecting which agent interacts next
        SelectionStrategy = new SequentialSelectionStrategy() 
        { 
            InitialAgent = writerAgent // Start the conversation with the Writer Agent
        },
        // Define the termination condition for the agent interactions, in this case, the Editor Agent will terminate the conversation
        TerminationStrategy = new NoFeedbackLeftTerminationStrategy()
    }
};
```

åœ¨ .NET Aspire ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°è¿™äº›ç»„ä»¶æ˜¯å¦‚ä½•ç¼–æ’çš„ï¼Œä¸ºç”¨æˆ·åˆ›é€ æ— ç¼ä½“éªŒã€‚è·Ÿè¸ªåŠŸèƒ½å…è®¸æˆ‘ä»¬ç›‘æ§ä»£ç†ä¹‹é—´çš„äº¤äº’ï¼Œè€Œé¥æµ‹åŠŸèƒ½æä¾›äº†å…³äºç”¨æˆ·è¡Œä¸ºå’Œ AI æ¨¡å‹æ€§èƒ½çš„æ´å¯Ÿã€‚
![å±•ç¤º .NET Aspire è·Ÿè¸ªåŠŸèƒ½çš„å›¾ç‰‡](../../../translated_images/aspire-tracing-creative-writer.fc87bb2777daf4e2efc54ea572c83ef7d09ce01cef4203d923e5591bde3b7fab.zh.png)

![å±•ç¤º .NET Aspire é¥æµ‹åŠŸèƒ½çš„å›¾ç‰‡](../../../translated_images/aspire-telemetry-creative-writer.aba9fd2e674a3cb021e2ff7d592d849cd7ebe5988037154ecc84b1b969747b40.zh.png)

> ğŸ§‘â€ğŸ’»**ç¤ºä¾‹**: æŸ¥çœ‹ [Creative Writing Agent ç¤ºä¾‹ä»£ç ](https://aka.ms/netaicreativewriter)

## æ¦‚è¦

è¿™äº›åªæ˜¯ä¸€äº›åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ç”Ÿæˆå¼ AI (GenAI) çš„ä¾‹å­ã€‚å…¶æ½œåŠ›æ˜¯æ— é™çš„ï¼Œè€Œä¸”æŠ€æœ¯æ­£åœ¨å¿«é€Ÿå‘å±•ã€‚æŸ¥çœ‹æˆ‘ä»¬çš„èµ„æºï¼Œäº†è§£æ›´å¤šå…³äº GenAI çš„ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•å°†å®ƒåº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚

> ğŸ™‹ **éœ€è¦å¸®åŠ©ï¼Ÿ**: å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨ä»£ç åº“ä¸­æäº¤ä¸€ä¸ª issueã€‚

### å…¶ä»–èµ„æº

- [eShopLite æ­é… DeepSeek](https://aka.ms/netaieshoplitedeepseekr1)
- [eShopLite æ­é… Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### åç»­æ­¥éª¤

äº†è§£è´Ÿè´£ä»»çš„ AI å®è·µï¼Œä»¥åŠå¦‚ä½•ç¡®ä¿ä½ çš„ AI æ¨¡å‹å…·æœ‰é“å¾·æ€§å¹¶äº§ç”Ÿç§¯æå½±å“ï¼

ğŸ‘‰ [è´Ÿè´£ä»»çš„ AI](../05-ResponsibleGenAI/readme.md)

**å…è´£å£°æ˜**ï¼š  
æœ¬æ–‡æ¡£ä½¿ç”¨åŸºäºäººå·¥æ™ºèƒ½çš„æœºå™¨ç¿»è¯‘æœåŠ¡è¿›è¡Œç¿»è¯‘ã€‚å°½ç®¡æˆ‘ä»¬å°½åŠ›ç¡®ä¿å‡†ç¡®æ€§ï¼Œä½†è¯·æ³¨æ„ï¼Œè‡ªåŠ¨ç¿»è¯‘å¯èƒ½åŒ…å«é”™è¯¯æˆ–ä¸å‡†ç¡®ä¹‹å¤„ã€‚åº”ä»¥åŸå§‹è¯­è¨€çš„æ–‡æ¡£ä½œä¸ºæƒå¨æ¥æºã€‚å¯¹äºå…³é”®ä¿¡æ¯ï¼Œå»ºè®®å¯»æ±‚ä¸“ä¸šäººå·¥ç¿»è¯‘ã€‚å› ä½¿ç”¨æœ¬ç¿»è¯‘è€Œå¼•èµ·çš„ä»»ä½•è¯¯è§£æˆ–è¯¯è¯»ï¼Œæˆ‘ä»¬æ¦‚ä¸è´Ÿè´£ã€‚