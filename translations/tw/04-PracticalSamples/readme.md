# æ¨™æº–ç”Ÿæˆå¼ AI ç¯„ä¾‹

åœ¨é€™äº›çœŸå¯¦ä¸”å¯¦ç”¨çš„ç¯„ä¾‹ä¸­ï¼Œçœ‹çœ‹æ‚¨å­¸åˆ°çš„æ¦‚å¿µå¦‚ä½•å¯¦éš›æ‡‰ç”¨ã€‚

---

## æ‚¨å°‡é”æˆçš„ç›®æ¨™

- ç­è§£ç”Ÿæˆå¼ AI å¦‚ä½•èå…¥ç¾æœ‰æ‡‰ç”¨ç¨‹å¼ã€‚
- å­¸ç¿’åœ¨è¤‡é›œå ´æ™¯ä¸­ä»£ç† (Agents) çš„é‹ä½œæ–¹å¼ã€‚

## åŒ…å«çš„ç¯„ä¾‹
- [æ¨™æº–ç”Ÿæˆå¼ AI ç¯„ä¾‹](../../../04-PracticalSamples)
  - [æ‚¨å°‡é”æˆçš„ç›®æ¨™](../../../04-PracticalSamples)
  - [åŒ…å«çš„ç¯„ä¾‹](../../../04-PracticalSamples)
  - [eShopLite ç¤ºç¯„](../../../04-PracticalSamples)
    - [eShopLite èˆ‡èªæ„æœå°‹ - In Memory](../../../04-PracticalSamples)
    - [eShopLite èˆ‡èªæ„æœå°‹ - Azure AI Search](../../../04-PracticalSamples)
    - [eShopLite èˆ‡å³æ™‚èªéŸ³åˆ†æ](../../../04-PracticalSamples)
  - [å‰µæ„å¯«ä½œä»£ç†](../../../04-PracticalSamples)
  - [ç¸½çµ](../../../04-PracticalSamples)
    - [å…¶ä»–è³‡æº](../../../04-PracticalSamples)
    - [ä¸‹ä¸€æ­¥](../../../04-PracticalSamples)


[![ç¸½è¦½å½±ç‰‡](https://img.youtube.com/vi/Ky4CACXJqR8/0.jpg)](https://youtu.be/Ky4CACXJqR8?feature=shared)

_â¬†ï¸é»æ“Šåœ–ç‰‡è§€çœ‹å½±ç‰‡â¬†ï¸_

## eShopLite ç¤ºç¯„

åœ¨æˆ‘å€‘çš„ç¬¬ä¸€çµ„ç¤ºç¯„ä¸­ï¼Œæˆ‘å€‘å°‡æ¢ç´¢ **eShopLite** å°ˆæ¡ˆã€‚**eShopLite** æ˜¯ä¸€å€‹å°ˆç‚ºæˆ¶å¤–è£å‚™èˆ‡éœ²ç‡Ÿæ„›å¥½è€…è¨­è¨ˆçš„ç°¡å–®é›»å•†æ‡‰ç”¨ç¨‹å¼ï¼Œä¸¦é€éç”Ÿæˆå¼ AI åŠŸèƒ½é€²è¡Œå¢å¼·ï¼Œä¾‹å¦‚æœå°‹åŠŸèƒ½å„ªåŒ–ã€å®¢æˆ¶æ”¯æŒå’Œå³æ™‚èªéŸ³åˆ†æã€‚

é€™äº›ç¤ºç¯„ä½¿ç”¨ [Azure OpenAI](https://azure.microsoft.com/products/ai-services/openai-service) å’Œ [Azure AI Foundry Models](https://ai.azure.com/) é€²è¡Œæ¨è«–ï¼ˆå³æ‡‰ç”¨ç¨‹å¼ä¸­çš„ç”Ÿæˆå¼ AI éƒ¨åˆ†ï¼‰ã€‚

åœ¨ç¬¬ä¸€å€‹ç¤ºç¯„ä¸­ï¼Œæˆ‘å€‘å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Semantic Kernel å¢å¼·æœå°‹åŠŸèƒ½ï¼Œä½¿å…¶èƒ½ç†è§£ä½¿ç”¨è€…æŸ¥è©¢çš„ä¸Šä¸‹æ–‡ä¸¦æä¾›æº–ç¢ºçš„çµæœã€‚

### eShopLite èˆ‡èªæ„æœå°‹

[![eShop èªæ„æœå°‹ç¤ºç¯„å½±ç‰‡](https://img.youtube.com/vi/FlkruF6USro/0.jpg)](https://youtu.be/FlkruF6USro?feature=shared)

_â¬†ï¸é»æ“Šåœ–ç‰‡è§€çœ‹å½±ç‰‡â¬†ï¸_

åœ¨ eShopLite çš„èªæ„æœå°‹ä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨ Semantic Kernel å¢å¼·é›»å•†æ‡‰ç”¨ç¨‹å¼çš„æœå°‹åŠŸèƒ½ã€‚Semantic Kernel å¹«åŠ©æˆ‘å€‘å‰µå»ºä¸€å€‹æ›´å¼·å¤§çš„æœå°‹å¼•æ“ï¼Œå¯ä»¥ç†è§£ä½¿ç”¨è€…æŸ¥è©¢çš„ä¸Šä¸‹æ–‡ä¸¦æä¾›æ›´æº–ç¢ºçš„çµæœã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä½¿ç”¨è€…æœå°‹ã€Œä½ æœ‰æ²’æœ‰ä»€éº¼å¯ä»¥ç”¨ä¾†çƒ¹é£ªçš„æ±è¥¿ã€ï¼Œæœå°‹å¼•æ“å¯ä»¥ç†è§£ä½¿ç”¨è€…æ­£åœ¨å°‹æ‰¾å»šæˆ¿ç”¨å“ï¼Œä¸¦é¡¯ç¤ºæœ€ç›¸é—œçš„ç”¢å“ã€‚åœ¨æ­¤ç¯„ä¾‹ä¸­ï¼Œå®ƒæœƒå›å‚³éœ²ç‡Ÿç‚Šå…·ã€‚

> ğŸ§‘â€ğŸ’»**ç¯„ä¾‹**: æŸ¥çœ‹ [eShopLite èªæ„æœå°‹ç¯„ä¾‹](https://aka.ms/netaieshoplitesemanticsearch)

![é¡¯ç¤º eShopLite æœå°‹åŠŸèƒ½çš„åœ–ç‰‡](../../../translated_images/search-eshoplite.066a1bd2d2be8ca0aedc75476dc0a167ffa9b9f7eb150bbddae26117aae55996.tw.png)

èªæ„æœå°‹å¯ä»¥å¹«åŠ©ä½¿ç”¨è€…æ›´è¼•é¬†åœ°æ‰¾åˆ°æ‰€éœ€ç”¢å“ï¼Œæå‡è³¼ç‰©é«”é©—ä¸¦å¢åŠ éŠ·å”®é‡ã€‚è¦å¯¦ç¾æ­¤åŠŸèƒ½ï¼Œæˆ‘å€‘éœ€è¦æœ‰ä¸€å€‹åŒ…å«ç”¢å“çš„å‘é‡å­˜å„²ã€ä¸€å€‹æœå°‹ç´¢å¼•å’Œä¸€å€‹èªè¨€æ¨¡å‹ã€‚[.NET Aspire](https://learn.microsoft.com/dotnet/aspire/get-started/aspire-overview) å·¥å…·å”åŠ©åœ¨å¾Œç«¯å”èª¿æ‰€æœ‰éç¨‹ã€‚

![é¡¯ç¤º .NET Aspire å„€è¡¨æ¿çš„åœ–ç‰‡](../../../translated_images/aspire-dashboard.39a6c455137a44de910501fb6c0a2549a2124061f6f8c1a75d176959a16a0c75.tw.png)

åœ¨ .NET Aspire å„€è¡¨æ¿ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°ç”¢å“ã€SQL å’Œå­˜å„²å®¹å™¨ï¼Œé€™äº›å®¹å™¨å¯ä»¥èˆ‡èªè¨€æ¨¡å‹äº’å‹•ã€‚æ·±å…¥äº†è§£ Aspire App Hostï¼Œæˆ‘å€‘æœ‰ä»¥ä¸‹å…§å®¹ï¼š

```csharp
if (builder.ExecutionContext.IsPublishMode)
{
    // Add the Azure Application Insights for monitoring
    var appInsights = builder.AddAzureApplicationInsights("appInsights");
    // Add the Azure OpenAI for the chat and embeddings deployments, the embedding is used for the vector entities
    var chatDeploymentName = "gpt-4o-mini";
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var aoai = builder.AddAzureOpenAI("openai")
        .AddDeployment(new AzureOpenAIDeployment(chatDeploymentName,
        "gpt-4o-mini",
        "2024-07-18",
        "GlobalStandard",
        10))
        .AddDeployment(new AzureOpenAIDeployment(embeddingsDeploymentName,
        "text-embedding-ada-002",
        "2"));

    products.WithReference(appInsights)
        .WithReference(aoai)
        .WithEnvironment("AI_ChatDeploymentName", chatDeploymentName)
        .WithEnvironment("AI_embeddingsDeploymentName", embeddingsDeploymentName);

    store.WithReference(appInsights)
        .WithExternalHttpEndpoints();
}
```

ä¸Šè¿°ç¨‹å¼ç¢¼å±•ç¤ºäº†å¦‚ä½•æ–°å¢ Azure Application Insights ç”¨æ–¼ç›£æ§ã€Azure OpenAI ç”¨æ–¼èŠå¤©å’ŒåµŒå…¥éƒ¨ç½²ï¼Œä»¥åŠç”¨æ–¼å‘é‡å¯¦é«”çš„åµŒå…¥ã€‚

åµŒå…¥å’Œ AOAI çš„å‰µå»ºå¯ä»¥åœ¨ç”¢å“å®¹å™¨ä¸­æ‰¾åˆ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
var azureOpenAiClientName = "openai";
builder.AddAzureOpenAIClient(azureOpenAiClientName);

// get azure openai client and create Chat client from aspire hosting configuration
builder.Services.AddSingleton<ChatClient>(serviceProvider =>
{
    var chatDeploymentName = "gpt-4o-mini";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Chat client configuration, modelId: {chatDeploymentName}");
    ChatClient chatClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        chatClient = client.GetChatClient(chatDeploymentName);
    }...
}
```

ä¸Šè¿°ç¨‹å¼ç¢¼å±•ç¤ºäº†å¦‚ä½•å¾ Aspire è¨—ç®¡é…ç½®ä¸­ç²å– Azure OpenAI å®¢æˆ¶ç«¯ä¸¦å‰µå»ºèŠå¤©å®¢æˆ¶ç«¯ã€‚`chatDeploymentName` æ˜¯æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨çš„éƒ¨ç½²åç¨±ã€‚åŒæ¨£çš„éç¨‹ä¹Ÿé©ç”¨æ–¼å‰µå»ºåµŒå…¥å®¢æˆ¶ç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
// get azure openai client and create embedding client from aspire hosting configuration
builder.Services.AddSingleton<EmbeddingClient>(serviceProvider =>
{
    var embeddingsDeploymentName = "text-embedding-ada-002";
    var logger = serviceProvider.GetService<ILogger<Program>>()!;
    logger.LogInformation($"Embeddings client configuration, modelId: {embeddingsDeploymentName}");
    EmbeddingClient embeddingsClient = null;
    try
    {
        OpenAIClient client = serviceProvider.GetRequiredService<OpenAIClient>();
        embeddingsClient = client.GetEmbeddingClient(embeddingsDeploymentName);
    }...
});
```

é€éé€™äº›ï¼Œæˆ‘å€‘å¯ä»¥å‰µå»º `MemoryContext` ä½œç‚ºå‘é‡å­˜å„²ï¼Œç”¨æ–¼æ¯”è¼ƒä½¿ç”¨è€…æŸ¥è©¢ä¸¦å›å‚³æœ€ç›¸é—œçš„ç”¢å“ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
// Iterate over the products and add them to the memory
_logger.LogInformation("Adding product to memory: {Product}", product.Name);
var productInfo = $"[{product.Name}] is a product that costs [{product.Price}] and is described as [{product.Description}]";

// Create a new product vector
var productVector = new ProductVector
{
    Id = product.Id,
    Name = product.Name,
    Description = product.Description,
    Price = product.Price,
    ImageUrl = product.ImageUrl
};

// Generate the embedding for the product information
var result = await _embeddingClient.GenerateEmbeddingAsync(productInfo);

// Convert the embedding result to a float array and assign it to the product vector
productVector.Vector = result.Value.ToFloats();
var recordId = await _productsCollection.UpsertAsync(productVector);
_logger.LogInformation("Product added to memory: {Product} with recordId: {RecordId}", product.Name, recordId);
```

ä¸Šè¿°ç¨‹å¼ç¢¼å±•ç¤ºäº†å¦‚ä½•éæ­·ç”¢å“ä¸¦å°‡å®ƒå€‘æ–°å¢åˆ°è¨˜æ†¶é«”ä¸­ã€‚

åœ¨å‰µå»ºæ–°çš„ç”¢å“å‘é‡å¾Œï¼Œæˆ‘å€‘ä½¿ç”¨å®ƒç”Ÿæˆç”¢å“è³‡è¨Šçš„åµŒå…¥ï¼Œå°‡åµŒå…¥çµæœè½‰æ›ç‚ºæµ®é»æ•¸é™£åˆ—ï¼Œä¸¦åˆ†é…çµ¦ç”¢å“å‘é‡ã€‚

æŸ¥çœ‹ `_productsCollection`ï¼Œå®ƒæ˜¯å­˜å„²ç”¢å“çš„å®¹å™¨çš„åƒè€ƒï¼Œä½¿ç”¨ CosmosDB èª¿ç”¨ä»¥ç²å–è¨˜éŒ„ ID çš„å›æ‡‰ã€‚åœ¨æ­¤æƒ…å¢ƒä¸­ï¼Œç”¨æ–¼è¨˜éŒ„ã€‚

ç„¶å¾Œå°‡ç”¢å“æ–°å¢åˆ°è¨˜æ†¶é«”ï¼Œå°é›†åˆä¸­çš„æ¯å€‹ç”¢å“é‡è¤‡æ­¤éç¨‹ã€‚

ä¹‹å¾Œï¼Œç•¶ä½¿ç”¨è€…æœå°‹ç”¢å“æ™‚ï¼Œæˆ‘å€‘å¯ä»¥å°‡ä½¿ç”¨è€…çš„æŸ¥è©¢èˆ‡ç”¢å“å‘é‡é€²è¡Œæ¯”è¼ƒï¼Œä¸¦å›å‚³æœ€ç›¸é—œçš„ç”¢å“ã€‚

```csharp
try
{
    // Generate embedding for the search query
    var result = await _embeddingClient.GenerateEmbeddingAsync(search);
    var vectorSearchQuery = result.Value.ToFloats();

    var searchOptions = new VectorSearchOptions()
    {
        Top = 1, // Retrieve the top 1 result
        VectorPropertyName = "Vector"
    };

    // Search the vector database for the most similar product
    var searchResults = await _productsCollection.VectorizedSearchAsync(vectorSearchQuery, searchOptions);
    double searchScore = 0.0;
    await foreach (var searchItem in searchResults.Results)
    {
        if (searchItem.Score > 0.5)
        {
            // Product found, retrieve the product details
            firstProduct = new Product
            {
                Id = searchItem.Record.Id,
                Name = searchItem.Record.Name,
                Description = searchItem.Record.Description,
                Price = searchItem.Record.Price,
                ImageUrl = searchItem.Record.ImageUrl
            };

            searchScore = searchItem.Score.Value;
            responseText = $"The product [{firstProduct.Name}] fits with the search criteria [{search}][{searchItem.Score.Value.ToString("0.00")}]";
            _logger.LogInformation($"Search Response: {responseText}");
        }
    }

    // Generate a friendly response message using the found product information
    var prompt = @$"You are an intelligent assistant helping clients with their search about outdoor products. Generate a catchy and friendly message using the following information:
    - User Question: {search}
    - Found Product Name: {firstProduct.Name}
    - Found Product Description: {firstProduct.Description}
    - Found Product Price: {firstProduct.Price}
    Include the found product information in the response to the user question.";

    var messages = new List<ChatMessage>
    {
        new SystemChatMessage(_systemPrompt),
        new UserChatMessage(prompt)
    };

    _logger.LogInformation("{ChatHistory}", JsonConvert.SerializeObject(messages));

    var resultPrompt = await _chatClient.CompleteChatAsync(messages);
}
```

é€éä¸Šè¿°ç¨‹å¼ç¢¼ï¼Œæˆ‘å€‘ç‚ºæœå°‹æŸ¥è©¢ç”ŸæˆåµŒå…¥ï¼Œæœå°‹å‘é‡è³‡æ–™åº«ä¸­æœ€ç›¸ä¼¼çš„ç”¢å“ï¼Œä¸¦ä½¿ç”¨æ‰¾åˆ°çš„ç”¢å“è³‡è¨Šç”Ÿæˆå›æ‡‰è¨Šæ¯ã€‚

é€™æ¨£å¯ä»¥å¹«åŠ©ä½¿ç”¨è€…æ›´è¼•é¬†åœ°æ‰¾åˆ°æ‰€éœ€ç”¢å“ï¼Œæå‡è³¼ç‰©é«”é©—ä¸¦å¢åŠ éŠ·å”®é‡ã€‚

æ­¤å¤–ï¼Œéš¨è‘—ç”Ÿæˆå¼ AI çš„ç™¼å±•ï¼Œæˆ‘å€‘éœ€è¦ä¸€äº›é™æ¸¬å’Œç›£æ§ä¾†ç­è§£ä½¿ç”¨è€…è¡Œç‚ºä¸¦æ”¹é€²æœå°‹å¼•æ“ï¼Œé€™æ­£æ˜¯ Azure Application Insights å’Œ .NET Aspire çš„ç”¨æ­¦ä¹‹åœ°ã€‚

![é¡¯ç¤º .NET Aspire è¿½è¹¤åŠŸèƒ½çš„åœ–ç‰‡](../../../translated_images/aspire-tracing-eshoplite.d275de72c3984defef2af13544b8ea00735154556e8878bffe2bab90419edb82.tw.png)

.NET Aspire æä¾›äº†ä¸€å¥—å¼·å¤§çš„å·¥å…·ä¾†ç›£æ§å’Œè¿½è¹¤æ‡‰ç”¨ç¨‹å¼çš„è¡Œç‚ºï¼ŒåŒ…æ‹¬ä½¿ç”¨è€…èˆ‡æœå°‹å¼•æ“ã€å¾Œç«¯æœå‹™ä»¥åŠ AI æ¨¡å‹çš„äº’å‹•ã€‚è¿½è¹¤åŠŸèƒ½å¯ä»¥å¹«åŠ©æˆ‘å€‘ç­è§£å¯èƒ½çš„ç“¶é ¸ã€éŒ¯èª¤å’Œæ€§èƒ½å•é¡Œï¼Œå¾è€Œå„ªåŒ–æ‡‰ç”¨ç¨‹å¼ä¸¦æä¾›æ›´å¥½çš„ä½¿ç”¨è€…é«”é©—ã€‚

![é¡¯ç¤º Azure Application Insights åœ¨ eShopLite ä¸­çš„åœ–ç‰‡](../../../translated_images/app-insights-eshoplite.24b107e2a7be99ecf71f619147fcc08f0b7b038a144e72945eaa5443beb27a1c.tw.png)

ç”±æ–¼é™æ¸¬å°æ–¼ç­è§£ä½¿ç”¨è€…è¡Œç‚ºå’Œæ”¹é€²æœå‹™è‡³é—œé‡è¦ï¼Œæˆ‘å€‘å¼•å…¥äº† Azure Application Insights ä¾†ç›£æ§æ‡‰ç”¨ç¨‹å¼çš„æ€§èƒ½å’Œä½¿ç”¨è€…äº’å‹•ã€‚

Application Insights æä¾›äº†ä¸€å¥—å®Œæ•´çš„é™æ¸¬æ•¸æ“šï¼Œå¹«åŠ©æˆ‘å€‘ç­è§£æœå‹™çš„æ€§èƒ½ä»¥åŠä½¿ç”¨è€…å¦‚ä½•èˆ‡æ‡‰ç”¨ç¨‹å¼äº’å‹•å’Œé›²ç«¯ä½¿ç”¨æƒ…æ³ã€‚

åœ¨åœ–ç‰‡ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° Application Insights å„€è¡¨æ¿ï¼Œæä¾›æœ‰é—œæœå‹™æ€§èƒ½çš„è³‡è¨Šï¼Œä¾‹å¦‚è³‡æ–™åº«èª¿ç”¨æ¬¡æ•¸ã€è«‹æ±‚æ•¸é‡å’Œå›æ‡‰æ™‚é–“ã€‚

> ğŸ’¡ **å°ˆæ¥­æç¤º**: æƒ³äº†è§£æ›´å¤šé—œæ–¼ eShopLite èˆ‡èªæ„æœå°‹çš„è³‡è¨Šï¼Œè«‹æŸ¥çœ‹æ­¤å­˜å„²åº«ï¼šhttps://aka.ms/netaieshoplitesemanticsearch

### eShopLite èˆ‡èªæ„æœå°‹ä½¿ç”¨ Azure AI Search

åœ¨ eShopLite çš„ç«¯åˆ°ç«¯ç¤ºç¯„ä¸­ï¼Œæˆ‘å€‘ä½¿ç”¨ **Azure AI Search** å¢å¼·é›»å•†æ‡‰ç”¨ç¨‹å¼çš„æœå°‹åŠŸèƒ½ã€‚Azure AI Search å¹«åŠ©æˆ‘å€‘å‰µå»ºä¸€å€‹æ›´å¼·å¤§çš„æœå°‹å¼•æ“ï¼Œå¯ä»¥ç†è§£ä½¿ç”¨è€…æŸ¥è©¢çš„ä¸Šä¸‹æ–‡ä¸¦æä¾›æ›´æº–ç¢ºçš„çµæœã€‚

å®ƒé‚„æä¾›äº†ä¸€å€‹æ›´å…·æ“´å±•æ€§å’Œå¯é æ€§çš„æœå°‹å¼•æ“ï¼Œå¯ä»¥è™•ç†å¤§é‡æ•¸æ“šå’Œä½¿ç”¨è€…æŸ¥è©¢ã€‚Azure AI Search å…è¨±è§£æ±ºæ–¹æ¡ˆæŒä¹…åŒ–æœå°‹ç´¢å¼•ï¼Œå› æ­¤å³ä½¿æ‡‰ç”¨ç¨‹å¼é‡æ–°å•Ÿå‹•ï¼Œè³‡è¨Šä¹Ÿå°‡å¯ç”¨ã€‚

- [eShopLite èˆ‡ Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### eShopLite èˆ‡å³æ™‚èªéŸ³åˆ†æ

[![eShop å³æ™‚èªéŸ³åˆ†æç¤ºç¯„å½±ç‰‡](https://img.youtube.com/vi/bx0hRNdr_bQ/0.jpg)](https://youtu.be/bx0hRNdr_bQ?feature=shared)

_â¬†ï¸é»æ“Šåœ–ç‰‡è§€çœ‹å½±ç‰‡â¬†ï¸_

åœ¨ eShopLite èˆ‡å³æ™‚èªéŸ³åˆ†æä¸­ï¼Œæˆ‘å€‘åˆ©ç”¨ GPT-4o çš„å³æ™‚èªéŸ³åŠŸèƒ½åˆ†æå®¢æˆ¶èˆ‡èŠå¤©æ©Ÿå™¨äººä¹‹é–“çš„å°è©±ï¼Œæä¾›æ›´å€‹æ€§åŒ–ä¸”æœ‰å¸å¼•åŠ›çš„é«”é©—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ¶è«‹æ±‚ç”¢å“æ¨è–¦ï¼ŒèŠå¤©æ©Ÿå™¨äººå¯ä»¥å³æ™‚åˆ†æå®¢æˆ¶çš„éœ€æ±‚ä¸¦æä¾›æ›´æº–ç¢ºä¸”ç›¸é—œçš„å›æ‡‰ã€‚

> ğŸ§‘â€ğŸ’»**ç¯„ä¾‹**: æŸ¥çœ‹ [eShopLite èªæ„æœå°‹ç¯„ä¾‹](https://aka.ms/netaieshopliterealtimechat)

![é¡¯ç¤º eShopLite å³æ™‚åˆ†æçš„åœ–ç‰‡](../../../04-PracticalSamples/images/realtime-analysis-eshoplite.gif)

è¦å¯¦ç¾æ­¤åŠŸèƒ½ï¼Œæˆ‘å€‘éœ€è¦æ–°å¢åŠŸèƒ½ä¾†å‰µå»ºå³æ™‚åˆ†æçš„ç«¯é»ï¼Œé€™å¯ä»¥åœ¨ `StoreRealtime\ConversationManager.cs` ä¸­æ‰¾åˆ°ã€‚

```csharp
public async Task RunAsync(
    Stream audioInput, 
    Speaker audioOutput, 
    Func<string, Task> addMessageAsync, 
    Func<string, bool, Task> addChatMessageAsync, 
    CancellationToken cancellationToken)
{
    // Define the initial prompt for the assistant
    var prompt = $"""
        You are a useful assistant.
        Respond as succinctly as possible, in just a few words.
        Check the product database and external sources for information.
        The current date is {DateTime.Now.ToLongDateString()}
        """;
```

é¦–å…ˆï¼Œæˆ‘å€‘ç‚ºåŠ©ç†å®šç¾©åˆå§‹æç¤ºï¼Œå‘ä½¿ç”¨è€…æä¾›å¦‚ä½•èˆ‡èŠå¤©æ©Ÿå™¨äººäº’å‹•çš„æŒ‡å°ã€‚è¨˜ä½è¦ä½¿ç”¨æ¸…æ™°ç°¡æ½”çš„æç¤ºï¼Œæç¤ºå·¥ç¨‹å°æ–¼å¾ AI æ¨¡å‹ç²å–æº–ç¢ºçµæœè‡³é—œé‡è¦ã€‚

```csharp
// Notify the user that the connection is being established
await addMessageAsync("Connecting...");

// Send an initial greeting message
await addChatMessageAsync("Hello, how can I help?", false);

// Create AI functions for semantic search and product name search
var contosoSemanticSearchTool = AIFunctionFactory.Create(_contosoProductContext.SemanticSearchOutdoorProductsAsync);
var contosoSearchByProductNameTool = AIFunctionFactory.Create(_contosoProductContext.SearchOutdoorProductsByNameAsync);

// Add the AI functions to a list of tools
List<AIFunction> tools = new List<AIFunction> { contosoSemanticSearchTool, contosoSearchByProductNameTool };
```

æ¥è‘—ï¼Œæˆ‘å€‘é€šçŸ¥ä½¿ç”¨è€…èŠå¤©å·²æº–å‚™å°±ç·’ä¸¦ç™¼é€åˆå§‹å•å€™è¨Šæ¯ã€‚ç„¶å¾Œï¼Œå‰µå»ºä¸¦æ–°å¢æœå°‹ç”¢å“ã€èªæ„æœå°‹ä»¥åŠæŒ‰ç”¢å“åç¨±æœå°‹çš„ AI åŠŸèƒ½åˆ°å·¥å…·åˆ—è¡¨ä¸­ï¼Œé€™äº›åŠŸèƒ½å¯ä»¥ç”¨ä¾†ç‚ºä½¿ç”¨è€…çš„æŸ¥è©¢æä¾›ç›¸é—œè³‡è¨Šã€‚

```csharp
// Configure the conversation session options
var sessionOptions = new ConversationSessionOptions()
{
    Instructions = prompt,
    Voice = ConversationVoice.Shimmer,
    InputTranscriptionOptions = new() { Model = "whisper-1" },
};

// Add each tool to the session options
foreach (var tool in tools)
{
    sessionOptions.Tools.Add(tool.ToConversationFunctionTool());
}

// Start the conversation session with the configured options
session = await client.StartConversationSessionAsync(cancellationToken);
await session.ConfigureSessionAsync(sessionOptions);

// Initialize a StringBuilder to store the output transcription
var outputTranscription = new StringBuilder();
```

æ¥è‘—é…ç½®å°è©±æœƒè©±é¸é …ï¼ŒåŒ…æ‹¬æŒ‡å°ã€èªéŸ³å’Œè¼¸å…¥è½‰éŒ„é¸é …ã€‚ä½¿ç”¨ `Whisper-1` æ¨¡å‹é€²è¡Œè¼¸å…¥è½‰éŒ„ã€‚

æ¯å€‹å·¥å…·éƒ½è¢«æ–°å¢åˆ°æœƒè©±é¸é …ä¸­ï¼Œä¸¦ä»¥é…ç½®çš„é¸é …é–‹å§‹å°è©±æœƒè©±ã€‚é€™äº›é¸é …å¯ä»¥æ ¹æ“šä½¿ç”¨è€…éœ€æ±‚é€²è¡Œèª¿æ•´ã€‚

> ğŸ§‘â€ğŸ’»**ç¯„ä¾‹**: æŸ¥çœ‹ [eShopLite èªæ„æœå°‹ç¯„ä¾‹](https://aka.ms/netaieshopliterealtimechat)

## å‰µæ„å¯«ä½œä»£ç†

[![å‰µæ„å¯«ä½œä»£ç†ç¤ºç¯„å½±ç‰‡](https://img.youtube.com/vi/ZjZWilI_5z8/0.jpg)](https://youtu.be/ZjZWilI_5z8?feature=shared)

_â¬†ï¸é»æ“Šåœ–ç‰‡è§€çœ‹å½±ç‰‡â¬†ï¸_

ä»£ç† (Agents) æ˜¯ç›®å‰ AI é ˜åŸŸä¸­çš„ç†±é–€è©±é¡Œï¼Œç‚ºäº†å±•ç¤ºå…¶åŠŸèƒ½ï¼Œæˆ‘å€‘å°‡ä½¿ç”¨å‰µæ„å¯«ä½œä»£ç†ï¼Œä¸€å€‹å¯ä»¥æ ¹æ“šä½¿ç”¨è€…è¼¸å…¥ç”Ÿæˆå‰µæ„ä¸”å¸å¼•äººçš„æ–‡å­—çš„å·¥å…·ï¼Œå¹«åŠ©æ’°å¯«ç¶“éç ”ç©¶ã€å…·é«”ä¸”å¸å¼•äººçš„å…§å®¹ã€‚

> ğŸ§‘â€ğŸ’»**ç¯„ä¾‹**: æŸ¥çœ‹ [å‰µæ„å¯«ä½œä»£ç†ç¯„ä¾‹ç¨‹å¼ç¢¼](https://aka.ms/netaicreativewriter)

![é¡¯ç¤ºå‰µæ„å¯«ä½œä»£ç†çš„åœ–ç‰‡](../../../translated_images/creative-writer-agent.0a8b63b3dd31452661ae33425defdc472b4d941724d9172a28c5d79bdc5d2faf.tw.png)

æ­¤è§£æ±ºæ–¹æ¡ˆåœç¹å››å€‹å°ˆé–€æ¨¡çµ„é€²è¡Œï¼Œçµåˆç”Ÿæˆé«˜å“è³ªå…§å®¹ï¼š

- **ç ”ç©¶å“¡ (Researcher)**ï¼šåˆ©ç”¨ Bing æœå°‹æ”¶é›†ä¸Šä¸‹æ–‡ã€ä¸»é¡Œå’Œæ•¸æ“šï¼Œä¸¦é€²è¡Œç°¡æ½”ç¸½çµã€‚
- **è¡ŒéŠ· (Marketing)**ï¼šè§£è®€ä½¿ç”¨è€…æ„åœ–ï¼Œæ§‹å»ºç›¸é—œå•é¡Œï¼Œä¸¦åˆ©ç”¨å‘é‡è³‡æ–™åº«æä¾›ç²¾ç¢ºçµæœã€‚
- **æ’°å¯«è€… (Writer)**ï¼šç¶œåˆç ”ç©¶å“¡å’Œè¡ŒéŠ·çš„çµæœï¼Œç”Ÿæˆé€£è²«çš„æ–‡ç« ã€‚
- **ç·¨è¼¯è€… (Editor)**ï¼šè©•ä¼°è‰ç¨¿ï¼Œæå‡ºä¿®æ”¹å»ºè­°ï¼Œä¸¦æ±ºå®šæ˜¯å¦å¯ä»¥ç™¼ä½ˆã€‚

æ•´å€‹æµç¨‹çµåˆç›¸é—œæ•¸æ“šã€æœ‰æ•ˆè¨Šæ¯å’Œå¯©æŸ¥ï¼Œç”± Semantic Kernelã€Microsoft AI Extension å’Œ .NET Aspire å”åŒé‹ä½œã€‚

![é¡¯ç¤ºå‰µæ„å¯«ä½œä»£ç†æ¶æ§‹çš„åœ–ç‰‡](../../../translated_images/creative-writer-agent-architecture.792ab7a807e66accb729c6a49d9393dd22f6060d83610cd1a187ab2b8a74efff.tw.png)

ç­è§£é€™äº›å…ƒä»¶å¦‚ä½•å½¼æ­¤äº¤äº’ï¼Œå¯ä»¥ä½œç‚ºå»ºç«‹æ‚¨è‡ªå·±çš„ä»£ç†æ‡‰ç”¨ç¨‹å¼çš„åƒè€ƒã€‚ä»¥ä¸‹ç¨‹å¼ç¢¼å±•ç¤ºäº†å…ƒä»¶å¦‚ä½•äº’å‹•ï¼Œé¦–å…ˆçœ‹çœ‹ `ChatController.cs` ä¸­å°å‰µæ„å¯«ä½œä»£ç†çš„èª¿ç”¨ï¼š

```csharp
var userInput = request.Messages.Last();

// Deserialize the user input content into a CreateWriterRequest object
CreateWriterRequest createWriterRequest = _yamlDeserializer.Deserialize<CreateWriterRequest>(userInput.Content);

// Create a new session for the Creative Writer application
var session = await _creativeWriterApp.CreateSessionAsync(Response);

// Process the streaming request and write the response in real-time
await foreach (var delta in session.ProcessStreamingRequest(createWriterRequest))
{
    // Serialize the delta and write it to the response stream and flush
    await response.WriteAsync($"{JsonSerializer.Serialize(delta)}\r\n");
    await response.Body.FlushAsync();
}
```

`CreateWriterRequest` needs to have three properties: `Research`, `Products`, and `Writing`. After getting them setted by processing the request, it calls the `CreateSessionAsync` æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š

```csharp
internal async Task<CreativeWriterSession> CreateSessionAsync(HttpResponse response)
{
    // Add custom function invocation filters to handle response modifications
    defaultKernel.FunctionInvocationFilters.Add(new FunctionInvocationFilter(response));

    // Create a separate kernel for Bing search integration and intialize the Bing service, and create a plugin for Bing search
    Kernel bingKernel = defaultKernel.Clone();
    BingTextSearch textSearch = new(apiKey: configuration["BingAPIKey"]!);
    KernelPlugin searchPlugin = textSearch.CreateWithSearch("BingSearchPlugin");
    bingKernel.Plugins.Add(searchPlugin);

    // Clone the default kernel to set up the vector search capabilities, and create the vector search kernel
    Kernel vectorSearchKernel = defaultKernel.Clone();
    await ConfigureVectorSearchKernel(vectorSearchKernel);

    // Return a new session encapsulating all configured kernels for comprehensive AI functionalities
    return new CreativeWriterSession(defaultKernel, bingKernel, vectorSearchKernel);
}
```

æ¥è‘—ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ° `CreativeWriterSession` class for the `ProcessStreamingRequest` function, to understand how the components interact with each other, first look at the `Research` and `Marketing` å…ƒä»¶ï¼š

```csharp
// Initialize the Researcher Agent with a specific prompt template.
// This agent leverages the Bing Kernel for enhanced semantic search capabilities.
ChatCompletionAgent researcherAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/researcher.yaml"))
{
    Name = ResearcherName,
    Kernel = bingKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = bingKernel.LoggerFactory
};

// Initialize the Marketing Agent with its own prompt template.
// This agent utilizes the Vector Search Kernel to handle product-related queries efficiently.
ChatCompletionAgent marketingAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/marketing.yaml"))
{
    Name = MarketingName,
    Kernel = vectorSearchKernel,
    Arguments = CreateFunctionChoiceAutoBehavior(),
    LoggerFactory = vectorSearchKernel.LoggerFactory
};

// ...

// Invoke the Researcher Agent asynchronously with the provided research context.
await foreach (ChatMessageContent response in researcherAgent.InvokeAsync(
    new object[] { }, 
    new Dictionary<string, string> { { "research_context", createWriterRequest.Research } }))
{
    // Aggregate the research results for further processing or display.
    sbResearchResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(ResearcherName),
        Content = response.Content,
    });
}

// ...

// Invoke the Marketing Agent with the provided product context.
await foreach (ChatMessageContent response in marketingAgent.InvokeAsync(
    new object[] { },
    new Dictionary<string, string> { { "product_context", createWriterRequest.Products } }))
{
    // Consolidate the product-related results for use in marketing strategies or user feedback.
    sbProductResults.AppendLine(response.Content);
    
    yield return new AIChatCompletionDelta(Delta: new AIChatMessageDelta
    {
        Role = AIChatRole.Assistant,
        Context = new AIChatAgentInfo(MarketingName),
        Content = response.Content,
    });
}
```

æœ€å¾Œï¼Œæˆ‘å€‘åˆå§‹åŒ–ä¸¦é…ç½® `Writer` and `Editor` ä»£ç†ã€‚è«‹åƒè€ƒä»¥ä¸‹ç¨‹å¼ç¢¼ï¼š

```csharp
// Initialize the Writer Agent with its specific prompt configuration
ChatCompletionAgent writerAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/writer.yaml"))
{
    Name = WriterName, 
    Kernel = kernel, /
    Arguments = new Dictionary<string, string>(), 
    LoggerFactory = kernel.LoggerFactory 
};

// Initialize the Editor Agent with its specific prompt configuration
ChatCompletionAgent editorAgent = new(ReadFileForPromptTemplateConfig("./Agents/Prompts/editor.yaml"))
{
    Name = EditorName, 
    Kernel = kernel, 
    LoggerFactory = kernel.LoggerFactory
};

// Populate the Writer Agent with contextual data required for generating content, gathered from the User, Researcher and Marketing Agents
writerAgent.Arguments["research_context"] = createWriterRequest.Research;
writerAgent.Arguments["research_results"] = sbResearchResults.ToString();
writerAgent.Arguments["product_context"] = createWriterRequest.Products;
writerAgent.Arguments["product_results"] = sbProductResults.ToString();
writerAgent.Arguments["assignment"] = createWriterRequest.Writing;

// Configure the Agent Group Chat to manage interactions between Writer and Editor
AgentGroupChat chat = new(writerAgent, editorAgent)
{
    LoggerFactory = kernel.LoggerFactory,
    ExecutionSettings = new AgentGroupChatSettings
    {
        // Define the strategy for selecting which agent interacts next
        SelectionStrategy = new SequentialSelectionStrategy() 
        { 
            InitialAgent = writerAgent // Start the conversation with the Writer Agent
        },
        // Define the termination condition for the agent interactions, in this case, the Editor Agent will terminate the conversation
        TerminationStrategy = new NoFeedbackLeftTerminationStrategy()
    }
};
```

åœ¨ .NET Aspire ä¸­ï¼Œæˆ‘å€‘å¯ä»¥çœ‹åˆ°å…ƒä»¶å¦‚ä½•è¢«å”èª¿ä»¥å‰µå»ºç„¡ç¸«çš„ä½¿ç”¨è€…é«”é©—ã€‚è¿½è¹¤åŠŸèƒ½å…è¨±æˆ‘å€‘ç›£æ§ä»£ç†ä¹‹é–“çš„äº’å‹•ï¼Œè€Œé™æ¸¬åŠŸèƒ½æä¾›ä½¿ç”¨è€…è¡Œç‚ºå’Œ AI æ¨¡å‹æ€§èƒ½çš„æ´å¯Ÿã€‚
![å±•ç¤º .NET Aspire è¿½è¹¤åŠŸèƒ½çš„åœ–ç‰‡](../../../translated_images/aspire-tracing-creative-writer.fc87bb2777daf4e2efc54ea572c83ef7d09ce01cef4203d923e5591bde3b7fab.tw.png)

![å±•ç¤º .NET Aspire é™æ¸¬åŠŸèƒ½çš„åœ–ç‰‡](../../../translated_images/aspire-telemetry-creative-writer.aba9fd2e674a3cb021e2ff7d592d849cd7ebe5988037154ecc84b1b969747b40.tw.png)

> ğŸ§‘â€ğŸ’»**ç¯„ä¾‹**: æŸ¥çœ‹ [Creative Writing Agent ç¯„ä¾‹ç¨‹å¼ç¢¼](https://aka.ms/netaicreativewriter)

## æ‘˜è¦

é€™äº›åªæ˜¯å±•ç¤ºå¦‚ä½•åœ¨æ‡‰ç”¨ç¨‹å¼ä¸­ä½¿ç”¨ GenAI çš„å¹¾å€‹ä¾‹å­ã€‚å¯èƒ½æ€§æ˜¯ç„¡çª®ç„¡ç›¡çš„ï¼Œè€Œä¸”é€™é …æŠ€è¡“æ­£åœ¨è¿…é€Ÿç™¼å±•ã€‚æŸ¥çœ‹æˆ‘å€‘çš„ä¸€äº›è³‡æºä¾†æ·±å…¥äº†è§£ GenAIï¼Œä¸¦å­¸ç¿’å¦‚ä½•åœ¨æ‚¨çš„å°ˆæ¡ˆä¸­æ‡‰ç”¨å®ƒã€‚

> ğŸ™‹ **éœ€è¦å¹«åŠ©å—ï¼Ÿ**: å¦‚æœæ‚¨é‡åˆ°ä»»ä½•å•é¡Œï¼Œè«‹åœ¨ repository ä¸­æäº¤ issueã€‚

### å…¶ä»–è³‡æº

- [eShopLite èˆ‡ DeepSeek](https://aka.ms/netaieshoplitedeepseekr1)
- [eShopLite èˆ‡ Azure AI Search](https://aka.ms/netaieshoplitesemanticsearchazureaisearch)

### ä¸‹ä¸€æ­¥

å­¸ç¿’æœ‰é—œè² è²¬ä»»çš„ AI å¯¦è¸ï¼Œä¸¦äº†è§£å¦‚ä½•ç¢ºä¿æ‚¨çš„ AI æ¨¡å‹ç¬¦åˆé“å¾·è¦ç¯„ä¸¦å¸¶ä¾†æ­£é¢å½±éŸ¿ï¼

ğŸ‘‰ [Responsible AI](../05-ResponsibleGenAI/readme.md)

**å…è²¬è²æ˜**ï¼š  
æœ¬æ–‡ä»¶ä½¿ç”¨åŸºæ–¼æ©Ÿå™¨çš„äººå·¥æ™ºèƒ½ç¿»è­¯æœå‹™é€²è¡Œç¿»è­¯ã€‚æˆ‘å€‘é›–ç„¶è‡´åŠ›æ–¼æä¾›æº–ç¢ºçš„ç¿»è­¯ï¼Œä½†è«‹æ³¨æ„ï¼Œè‡ªå‹•ç¿»è­¯å¯èƒ½åŒ…å«éŒ¯èª¤æˆ–ä¸æº–ç¢ºä¹‹è™•ã€‚æ‡‰ä»¥åŸæ–‡çš„æ¯èªç‰ˆæœ¬ä½œç‚ºæ¬Šå¨ä¾†æºã€‚å°æ–¼é—œéµä¿¡æ¯ï¼Œå»ºè­°å°‹æ±‚å°ˆæ¥­äººå·¥ç¿»è­¯ã€‚æˆ‘å€‘å°å› ä½¿ç”¨æ­¤ç¿»è­¯è€Œå¼•èµ·çš„ä»»ä½•èª¤è§£æˆ–èª¤è®€ä¸æ‰¿æ“”è²¬ä»»ã€‚